[
  {
    "title": "$:/plugins/danielo515/tiddlypouch",
    "description": "tiddlypouch for TiddlyWiki",
    "author": "Danielo Rodriguez",
    "core-version": ">=5.1.14",
    "list": "readme",
    "version": "0.20.1-0",
    "released": "Sun, 22 Jan 2017 14:39:03 GMT",
    "plugin-type": "plugin",
    "dependents": "",
    "type": "application/json",
    "text": "{\n    \"tiddlers\": {\n        \"$:/plugins/danielo515/tiddlypouch/boot\": {\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/boot\",\n            \"tags\": \"$:/tags/RawMarkup\",\n            \"text\": \"<style>\\r\\n    #TP_splash_screen {\\r\\n         position: fixed;\\r\\n         top: 0;\\r\\n         left: 0;\\r\\n         width: 100%;\\r\\n         height: 100%;\\r\\n         background-color: #FFF;\\r\\n         margin: 0;\\r\\n         font-size: 14px;\\n\\n        -webkit-transition: opacity 2s ease-in-out;\\r\\n        -moz-transition: opacity 2s ease-in-out;\\r\\n        -ms-transition: opacity 2s ease-in-out;\\r\\n        -o-transition: opacity 2s ease-in-out;\\r\\n        transition: opacity 2s ease-in-out;\\r\\n    }\\r\\n    #TP_splash_screen>h1{\\r\\n       text-align: center;\\r\\n       color: #CECECE;\\r\\n       font-size: 5.5em;\\n\\n       width: 100%;\\r\\n       position: relative;\\r\\n       word-wrap: break-word;\\r\\n       font-weight: 300;\\r\\n       margin: 0.67em 0;\\r\\n       line-height: 1.2;\\r\\n       font-family: \\\"Helvetica Neue\\\", Helvetica, Arial, \\\"Lucida Grande\\\", \\\"DejaVu Sans\\\", sans-serif;\\r\\n       text-rendering: optimizeLegibility;\\r\\n      -webkit-font-smoothing: antialiased;\\r\\n      -webkit-box-sizing: border-box;\\r\\n      box-sizing: border-box;\\n\\n\\r\\n    }\\r\\n    @media (min-width: 1200px) {\\r\\n        #TP_splash_screen>h1 {\\r\\n            font-size: 12em;\\r\\n        }\\r\\n    }\\r\\n    #TP_splash_screen>h1:before {\\r\\n        content: attr(data-text);\\r\\n        overflow: hidden;\\r\\n        position: absolute;\\r\\n        max-width: 5.5em;\\r\\n        white-space: nowrap;\\r\\n        color: #93cf93;\\r\\n        animation: loading 6s linear;\\r\\n    }\\r\\n    @keyframes loading {\\r\\n        0% {\\r\\n            max-width: 0;\\r\\n        }\\r\\n    }\\n\\n</style>\\n\\n\\r\\n<script>\\r\\n    (function(window){\\r\\n        'use strict';\\r\\n        /***** Base TiddlyPouch module creation ****/\\r\\n        var $TPouch = window.$TPouch || Object.create(null);\\r\\n        if($TPouch.supressBoot){ /** Allow external JS to avoid boot */\\r\\n            return\\r\\n        }\\r\\n        $TPouch._configDb = $TPouch._configDb || new PouchDB('__TP_config');\\r\\n        $TPouch.splashScreen = $TPouch.splashScreen || Object.create(null);\\r\\n        /*** The version section is automatically updated by build scripts,  Dont delete the below comment */\\r\\n        $TPouch.VERSION = /***TPOUCH_VER*/'0.20.1-0'/*TPOUCH_VER***/;\\n\\n        var $tw = window.$tw || Object.create(null);\\r\\n        $tw.boot = $tw.boot || Object.create(null);\\r\\n        $tw.boot.suppressBoot = true\\n\\n        window.$TPouch = $TPouch;\\r\\n        window.$tw = $tw;\\n\\n        /** Creates a new message node to be used on the splashScreen*/\\r\\n        function createSplashMessageNode(message){\\n\\n            var h1 = document.createElement(\\\"h1\\\");\\r\\n            h1.setAttribute(\\\"data-text\\\",message);\\r\\n            var text = document.createTextNode(message);\\r\\n            h1.appendChild(text);\\r\\n            return h1;\\r\\n        }\\n\\n        function createSplashScreen(message){\\n\\n            /* This function waits until document.body exists*/\\r\\n            function tryToAppend(node){\\r\\n                if(!document.body){\\r\\n                    return setTimeout(tryToAppend.bind(null,node),1);\\r\\n                }\\r\\n                document.body.appendChild( node, document.body.firstChild );\\r\\n            }\\n\\n            var splash = document.getElementById('TP_splash_screen');\\r\\n            if( splash === null){\\r\\n                splash = document.createElement(\\\"div\\\");\\r\\n                splash.setAttribute(\\\"id\\\",\\\"TP_splash_screen\\\");\\r\\n                splash.appendChild(createSplashMessageNode(message));\\r\\n                tryToAppend(splash);\\r\\n            } else{\\r\\n                splashMessage(message);\\r\\n            }\\n\\n            $TPouch.splashScreen.node = splash;\\r\\n        }\\r\\n        /** Hides the splash screen allowing the cool css animation to execute*/\\r\\n        $TPouch.splashScreen.hide = function hideSplashScreen(){\\r\\n            /** We first set opacity to 0 to allow the css animations kick in\\r\\n             * Two seconds later , when animation has finished\\r\\n             * we set display to none so it does not takes space on the page.\\r\\n             * Display none can not be animated, that's why we use opacity first.\\r\\n            */\\r\\n            $TPouch.splashScreen.node.style.opacity = 0;\\r\\n            setTimeout( function(){\\n\\n                $TPouch.splashScreen.node.style.display = \\\"none\\\";\\r\\n            } ,2000);\\n\\n        };\\r\\n        $TPouch.splashScreen.showMessage = function splashMessage(message){\\n\\n            var node = $TPouch.splashScreen.node;\\r\\n            node.replaceChild(createSplashMessageNode(message), node.firstChild)\\r\\n            node.style.display = \\\"block\\\";\\r\\n            node.style.opacity = 1;\\r\\n        };\\n\\n        /**\\r\\n         * Checks if the current version on the database is lower than the current version\\r\\n         * if so, it deletes all the indexes so they can be recreated\\r\\n         * @param {string} version - The version of TiddlyPouch that the database being updated has\\r\\n         * @param {PouchDB} db - The actual Pouch database that we are updating\\r\\n         * @returns {promise} - promise that fulfills when all the indexes have been processed, removed or failed removing\\r\\n         */\\r\\n            function updater(version, db) {\\n\\n                var documentsToRemove = [\\r\\n                    '_design/by_type', '_design/skinny_tiddlers',\\r\\n                    '_design/by_plugin_type' , '_design/filtered_replication',\\r\\n                    '_design/TiddlyPouch','_design/startup_tiddlers'\\r\\n                    ];\\n\\n                if (version && !(parseInt(version.split('.').join('')) < parseInt($TPouch.VERSION.split('.').join('')))) {\\r\\n                    return Promise.resolve();\\r\\n                }\\r\\n                console.log('Starting update process...');\\r\\n                $TPouch.splashScreen.showMessage('Updating database');\\r\\n                return Promise.all(\\r\\n                    documentsToRemove\\r\\n                        .map(function (doc) {\\n\\n                            return db.get(doc)\\r\\n                                .then(function (docu) {\\r\\n                                    console.log('Removing index ', doc);\\r\\n                                    return db.remove(docu)\\r\\n                                })\\r\\n                                .catch(console.log.bind(console, 'Error removing ', doc))\\r\\n                        })\\r\\n                    )\\r\\n                    .then(function () {\\r\\n                        console.log('Update process complete');\\r\\n                    });\\r\\n            }\\n\\n\\n\\n        createSplashScreen('Loading');\\n\\n        $TPouch._configDb.get('configuration') // we read the configuration to know which database shuld be loaded\\r\\n        .then(function(config){\\n\\n            if(!config.selectedDbId){\\r\\n                throw new Error('There is no DB selected, nothing to inject')\\r\\n            }\\r\\n            /** Create the default db, it should be wrapped later on the boot proces in a {@link DbStore} */\\r\\n            $TPouch._db = new PouchDB(config.selectedDbId);\\r\\n            var oldVer = config.databases[config.selectedDbId].version;\\r\\n            return updater(oldVer , $TPouch._db)\\r\\n                    .then(function(){ /** After the update process, flag the db with latest version */\\r\\n                        config.databases[config.selectedDbId].version = $TPouch.VERSION;\\r\\n                        return $TPouch._configDb.put(config);\\r\\n                    })\\r\\n        })\\r\\n        .then(function(){\\n\\n            return $TPouch._db.query('startup_tiddlers', { include_docs: true })\\r\\n        })\\r\\n        .then(function(all){ //Actual docs are contained in the rows array\\n\\n            console.log('Injecting ', all.total_rows, ' startup tiddlers into tw');\\r\\n            var startupTids = all.rows.map(function(row){\\n\\n                return row.doc.fields\\r\\n            });\\r\\n            window.$tw.preloadTiddlers = startupTids;\\r\\n        }).catch(function(reason){ // catch any possible error and continue the chain\\n\\n            console.log('Something went wrong during plugin injection ', reason);\\r\\n        }).then(function(){\\r\\n            try{\\r\\n                $tw.boot.boot(); // boot when chain completes, even if we got some errors\\r\\n            }catch(err){\\r\\n                console.error('Something went wrong booting tiddlywiki ',err);\\r\\n                window.location.reload();\\r\\n            }\\n\\n        })\\n\\n\\n\\n    })(window);\\r\\n</script>\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/converters/converter.js\": {\n            \"text\": \"/*\\\\\\r\\ntitle: $:/plugins/danielo515/tiddlypouch/converters/converter.js\\r\\ntype: application/javascript\\r\\nmodule-type: library\\r\\n\\r\\nBasic converter. Used by other decorators (AKA converters)\\r\\n\\r\\n@preserve\\r\\n\\r\\n\\\\*/\\r\\n\\r\\n'use strict'\\r\\n\\r\\n/*jslint node: true, browser: true */\\r\\n/*global $tw: false */\\r\\n/* global module */\\r\\n/** @namespace {converters} converter */\\r\\n\\r\\n/***====================EXPORTS============================ */\\r\\nmodule.exports.decorate = Converter;\\r\\n\\r\\n/**\\r\\n * Base converter decorator\\r\\n *\\r\\n * @param {any} db - database to decorate with this converter methods\\r\\n * @returns {any} db - the same db but decorated with the methods of this converter\\r\\n */\\r\\nfunction Converter(db) {\\r\\n    /***===================== CONVERSIONS BETWEEN TW AND PouchDB ============= */\\r\\n    /**\\r\\n    * CouchDB does not like document IDs starting with '_'.\\r\\n    * Convert leading '_' to '%5f' and leading '%' to '%25'\\r\\n    * Only used to compute _id / URL for a tiddler. Does not affect 'title' field.\\r\\n    * @param {String} title The title of the tiddler to mangle\\r\\n    * @return {String} The same title ready to be inserted into PouchDB/couchdb\\r\\n    */\\r\\n    db._mangleTitle = function mangleTitle(title) {\\r\\n        if (title.length == 0) {\\r\\n            return title;\\r\\n        }\\r\\n        var firstChar = title.charAt(0);\\r\\n        var restOfIt = title.substring(1);\\r\\n        if (firstChar === '_') {\\r\\n            return '%5f' + restOfIt;\\r\\n        }\\r\\n        else if (firstChar === '%') {\\r\\n            return '%25' + restOfIt;\\r\\n        }\\r\\n        else {\\r\\n            return title;\\r\\n        }\\r\\n    };\\r\\n\\r\\n    return db;\\r\\n\\r\\n}\",\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/converters/converter.js\",\n            \"type\": \"application/javascript\",\n            \"module-type\": \"library\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/dbstore/factory\": {\n            \"text\": \"/*\\\\\\r\\ntitle: $:/plugins/danielo515/tiddlypouch/dbstore/factory\\r\\ntype: application/javascript\\r\\nmodule-type: library\\r\\n\\r\\nA factory of DbStores. This factory is responsible of instantiating the DbStores and inject them the required dependecies\\r\\n\\r\\n@preserve\\r\\n\\r\\n\\\\*/\\r\\n\\r\\n'use strict'\\r\\n\\r\\n/*jslint node: true, browser: true */\\r\\n/*global $tw: false */\\r\\n\\r\\nmodule.exports = factory;\\r\\n\\r\\n/** The dbStore class should export a function constructor. @see DbStore */\\r\\nvar DbStore = require('$:/plugins/danielo515/tiddlypouch/DbStore.js');\\r\\n/** This list should be built automatically based on some kind of module system,\\r\\n * but for the moment, just create it manually\\r\\n */\\r\\nvar converters = {\\r\\n    'tiddlers': require('$:/plugins/danielo515/tiddlypouch/converters/tiddler'),\\r\\n    'plugins': require('$:/plugins/danielo515/tiddlypouch/converters/plugins')\\r\\n};\\r\\n\\r\\n/**\\r\\n * Factory that instantiates DbStores.\\r\\n *\\r\\n * It is responsible of injecting the tiddler conversion logic into the instantiated database.\\r\\n * Conversion logic is extracted from a list of converter modules.\\r\\n * Each converther should decorate the database with the {@link DbDecorator} interface\\r\\n * @see DbStore\\r\\n *\\r\\n * @param {String} dbName the name of the database to instantiate. It will be created if it does not exist\\r\\n * @param {String} dbType the type of database you want. This determines the conversion logic,\\r\\n *                        so basically this is a converter name.\\r\\n * @param {PouchDB} [dbToWrap] - An already existing database to wrap, instead of being created\\r\\n * @returns {DbStore} a ready to use instance of DbStore class with the conversion logic injected\\r\\n */\\r\\nfunction factory( dbName, dbType , dbToWrap ){\\r\\n    dbType = dbType || 'tiddlers';\\r\\n    var converter = converters[dbType];\\r\\n\\r\\n    var db = new DbStore(dbName , dbToWrap);\\r\\n    return converter.decorate(db);\\r\\n\\r\\n}\\r\\n\\r\\n\\r\\n/**\\r\\n * Should decorate any given {@link DbStore} with the following methods.\\r\\n * Monkey patching is the method used\\r\\n *\\r\\n * @interface DbDecorator\\r\\n */\\r\\n/**\\r\\n *\\r\\n *\\r\\n * @function\\r\\n * @name DbDecorator#_convertToCouch\\r\\n *\\r\\n * @param {Tiddler} tiddler - the tiddler to convert to CouchDB format\\r\\n * @param {object} tiddlerInfo - The metadata about the tiddler that the sync mechanism of tiddlywiki provides.\\r\\n *                               This includes the revision and other metadata related to the tiddler that is not\\r\\n *                               included in the tiddler.\\r\\n * @returns {object} doc - An document object that represents the tiddler. Ready to be inserted into CouchDB\\r\\n */\\r\\n/**\\r\\n * This method should handle any required conversion to create a document id from a tiddler title.\\r\\n * It should be static and have no side effects.\\r\\n * @function\\r\\n * @name DbDecorator#_mangleTitle\\r\\n * @param {String} title - Any tiddler title\\r\\n * @returns {String} title compatible with the destination database\\r\\n */\\r\\n/**\\r\\n * Transforms a pouchd document extracting just the fields that should be\\r\\n * part of the tiddler discarding all the metadata related to PouchDB.\\r\\n * @function\\r\\n * @name DbDecorator#_convertFromCouch\\r\\n * @param {object} doc - A couchdb object containing a tiddler representation inside the fields sub-object\\r\\n * @returns {object} fields ready for being added to a wiki store\\r\\n */\",\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/dbstore/factory\",\n            \"type\": \"application/javascript\",\n            \"module-type\": \"library\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/DbStore.js\": {\n            \"text\": \"/*\\\\\\r\\ntitle: $:/plugins/danielo515/tiddlypouch/DbStore.js\\r\\ntype: application/javascript\\r\\nmodule-type: library\\r\\n\\r\\nManages insertions, extractions, deletions of tiddlers to a database.\\r\\n\\r\\n@preserve\\r\\n\\r\\n\\\\*/\\r\\n\\r\\n'use strict';\\r\\n/* global PouchDB */\\r\\n/*jslint node: true, browser: true */\\r\\n/* global $tw, module */\\r\\n\\r\\n/***====================== EXPORTS  ========================== */\\r\\n\\r\\nmodule.exports = DbStore;\\r\\n\\r\\n/**\\r\\n * @classdesc Handles the operations related to fetching and saving tiddlers to a database.\\r\\n * it is the PouchDB equivalent to the wiki store.\\r\\n *\\r\\n * It expects some methods to be injected: _convertFromCouch, _convertToCouch, _mangleTitle\\r\\n * such injection is responsibility of the factory that instantiates this objects.\\r\\n *\\r\\n * @see DbStore.factory\\r\\n *\\r\\n * If the database does not exist it will be created\\r\\n * @class\\r\\n * @param {String} dbName The name should match the PouchDB name\\r\\n * @param {PouchDB} [db] An already existing PouchDB database object to wrap .\\r\\n */\\r\\nfunction DbStore(dbName/**String */, db /**PouchDB db Optional */) {\\r\\n    this.name = dbName;\\r\\n    this._db = db instanceof PouchDB ? db : new PouchDB(dbName);\\r\\n    this.logger = new $TPouch.Logger(\\\"DbStore:\\\" + dbName);\\r\\n}\\r\\n\\r\\n\\r\\n/***====================== PURE DB METHODS ========================== */\\r\\n\\r\\n/**\\r\\n * Creates generic conflict-handler functions.\\r\\n * The returned function logs a default message to the console in case of conflict,\\r\\n * otherwise it throws the error so the next catch on the promise chain can handle it\\r\\n *\\r\\n * @param {any} message the message the returned handler will log to the console in case of conflict\\r\\n * @returns {function} handler a function ready to be used inside a catch statement in a promise chain\\r\\n * @static\\r\\n */\\r\\nDbStore.prototype._Conflict = function conflict(message) {\\r\\n    var self = this;\\r\\n    return function (err) {\\r\\n        if (err.status == 409) {\\r\\n            return self.logger.log(message);\\r\\n        }\\r\\n        throw err;\\r\\n    }\\r\\n}\\r\\n\\r\\n// Source: https://pouchdb.com/2014/05/01/secondary-indexes-have-landed-in-pouchdb.html\\r\\n/**\\r\\n * Creates an index with the given name. In CouchDB this means a design document\\r\\n * with a map function that emits the key to be indexed\\r\\n * @example createIndex('by_type' , function(doc){ emit(doc.fields.type) })\\r\\n * @public\\r\\n * @param {String} name The name of the index, ej: by_type\\r\\n * @param {function} mapFunction A couch map function that will be used to build the index\\r\\n * @return {promise} A promise that fulfills when the design document is inserted\\r\\n */\\r\\nDbStore.prototype.createIndex = function createDesignDoc(name, mapFunction) {\\r\\n    var ddoc = {\\r\\n        _id: '_design/' + name,\\r\\n        views: {\\r\\n        }\\r\\n    };\\r\\n    ddoc.views[name] = { map: mapFunction.toString() };\\r\\n    this.logger.debug('Creating index' + name + '...')\\r\\n    return this._db.put(ddoc)\\r\\n        .then(this.logger.debug.bind(this.logger, 'Index ' + name + ' created'))\\r\\n        .catch(this._Conflict('Index ' + name + ' exists already'));\\r\\n}\\r\\n\\r\\n/**\\r\\n * Updates a document on the database if it exists.\\r\\n * Creates a new document if it does not exist.\\r\\n * If the document has a revision but it is new it will throw a conflict\\r\\n * so we look for it and if we get a 404 (not found) we remove the revision\\r\\n * and try to create it again.\\r\\n *\\r\\n * @param {any} document  - It should be a document ready to be inserted,\\r\\n *                          no conversion from TW format will be performed.\\r\\n * @returns {promise} A promise that fulfills when the document is upserted\\r\\n */\\r\\nDbStore.prototype._upsert = function (document) {\\r\\n    var self = this;\\r\\n    return self._db.put(document)\\r\\n        .then(function (saveInfo) {\\r\\n            return saveInfo\\r\\n        })\\r\\n        .catch(function (err) {\\r\\n            if (err) {\\r\\n                if (err.name === 'conflict') { // check if it is a real conflict\\r\\n                    self.logger.debug('O my gosh, update conflict!')\\r\\n                    return self._db.get(document._id)\\r\\n                        .then(function (document) { //oops, we got a document, this was an actual conflict\\r\\n                            self.logger.log(\\\"A real update conflict!\\\", document);\\r\\n                            throw err; // propagate the error for the moment\\r\\n                        })\\r\\n                        .catch(function (err) {\\r\\n                            if (err.name === 'not_found') { // not found means no actual conflict\\r\\n                                self.logger.debug(\\\"Fake conflict, trying again\\\", document);\\r\\n                                document._rev = null;\\r\\n                                return self._db.put(document);\\r\\n                            }\\r\\n                        });\\r\\n\\r\\n                }\\r\\n                throw err //propagate the error if it is not a conflict\\r\\n            }\\r\\n\\r\\n        });\\r\\n\\r\\n};\\r\\n\\r\\n\\r\\n/**\\r\\n * Validates the passed revision according to PouchDB revision format.\\r\\n * If the revision passes the validation then it is returned.\\r\\n * If it does not, null is returned\\r\\n *\\r\\n * @param {string} rev - the revision to validate\\r\\n * @static\\r\\n * @private\\r\\n * @returns {String|null} The revision if it has the correct format, null otherwhise\\r\\n */\\r\\nDbStore.prototype._validateRevision = function validateRevision(rev) {\\r\\n    if (/\\\\d+-[A-z0-9]*/.test(rev)) {\\r\\n        return rev\\r\\n    }\\r\\n    return null\\r\\n};\\r\\n\\r\\n/***============================ TIDDLER STORE METHODS ======== */\\r\\n\\r\\n/**\\r\\n * Adds a tiddler to the database.\\r\\n * It handles all the required conversions for making it compatible with CouchDB or PouchDB\\r\\n *\\r\\n * @param {object} tiddler A tiddler fields object. Not a regular tiddler.\\r\\n * @param {object} options Metadata about this tiddler. Usually provided by the syncer\\r\\n * @return {promise} fulfills when the tiddler is saved failed to save.\\r\\n */\\r\\nDbStore.prototype.addTiddler = function (tiddler, options) {\\r\\n    var self = this;\\r\\n    var convertedTiddler = this._convertToCouch(tiddler, options.tiddlerInfo);\\r\\n    this.logger.debug(\\\"Saving \\\", convertedTiddler);\\r\\n    return self._upsert(convertedTiddler);\\r\\n};\\r\\n\\r\\nDbStore.prototype.deleteTiddler = function (title) {\\r\\n    var self = this;\\r\\n    var docID = self._mangleTitle(title);\\r\\n    return self._db.get(docID)\\r\\n        .then(function (doc) {\\r\\n            doc._deleted = true;\\r\\n            return self._db.put(doc);\\r\\n        })\\r\\n        .catch(self.logger.log.bind(self.logger, 'Something went wrong deleting ' + title))\\r\\n}\\r\\n\\r\\nDbStore.prototype.getTiddler = function (title, revision) {\\r\\n    var self = this;\\r\\n    var query = [self._mangleTitle(title)]\\r\\n    /** Because PouchDB uses the arguments object we can not pass an undefined value as\\r\\n     * second parameter, they try to use it. So to be able to make the query in just one call\\r\\n     * we create an array that dinamycally adds the extra options only if they are required.\\r\\n     * This way, we can call the get function without passing any undefined value\\r\\n     */\\r\\n    if (self._validateRevision(revision)) {\\r\\n        query.push({ rev: revision });\\r\\n    }\\r\\n    self.logger.debug('Retrieving tiddler ', title, ' from database');\\r\\n    return self._db.get.apply(self._db, query)\\r\\n        .then(self._convertFromCouch.bind(self))\\r\\n        .catch(function (err) {\\r\\n            self.logger.log('Error getting tiddler ' + title + ' from DB', err);\\r\\n            throw err;\\r\\n        });\\r\\n};\\r\\n\\r\\n/**\\r\\n * Queries an existing index (not controlled) for tiddlers.\\r\\n *\\r\\n * @param {String} index          - an existing database index that you want to use for the search\\r\\n * @param {String} [search_term]  -  it will be used as key search (the first value emited on the map function)\\r\\n * @param {Boolean} [includeDocs] - Defaults to true. If the documents of the search result should be included or not.\\r\\n *                                  There are some scenarios where you don't want the document to be included,\\r\\n *                                  querying for skinny tiddlers for example\\r\\n * @return {promise} fulfills to an array of already converted tiddlers\\r\\n */\\r\\nDbStore.prototype.getTiddlers = function( index, search_term, includeDocs ){\\r\\n     var self = this;\\r\\n     var queryOptions = { include_docs: (undefined === includeDocs ) ? true : includeDocs };\\r\\n\\r\\n     if( search_term ){\\r\\n         queryOptions.key = search_term;\\r\\n     }\\r\\n\\r\\n        return self._db.query(index, queryOptions)\\r\\n            .then(function (result) {\\r\\n                self.logger.trace(\\\"Query to \\\",index,\\\" searching for \\\", search_term,\\\" : \\\", result.rows);\\r\\n                return result.rows\\r\\n            })\\r\\n            .then(function (rows) {\\r\\n                /** query Api returns documents in a different format, we have to convert them to the format convertFromCouch expects */\\r\\n                return rows.map(function (doc) {\\r\\n                    return doc.doc ? doc.doc : { // if doc is included just retur it or try to make a conversion otherwhise\\r\\n                        // the key is missed! maybe provide a conversion function as parameter?\\r\\n                        _id: doc.id,\\r\\n                        fields: doc.value\\r\\n                    }\\r\\n                })\\r\\n            }).then(function (documents) {\\r\\n                return documents.map(self._convertFromCouch.bind(self));\\r\\n            })\\r\\n            .catch(self.logger.log.bind(self.logger));\\r\\n};\\r\\n\\r\\n/**\\r\\n * returns the revisions of a given tiddler.\\r\\n * Only available revisions are returned\\r\\n * @param {string} title The tiddler's title you want the revisions\\r\\n * @return {promise} promise that fulfills to an array of revisions\\r\\n */\\r\\nDbStore.prototype.getTiddlerRevisions = function (title) {\\r\\n    return this._db.get(this._mangleTitle(title), { revs_info: true })\\r\\n        .then(function (document) {\\r\\n            var revisions = document._revs_info.filter(onlyAvailable).map(getRevisionId);\\r\\n            return revisions;\\r\\n        });\\r\\n\\r\\n    function onlyAvailable(rev) { return rev.status === \\\"available\\\"; }\\r\\n    function getRevisionId(rev) { return rev.rev; }\\r\\n}\",\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/DbStore.js\",\n            \"type\": \"application/javascript\",\n            \"module-type\": \"library\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/converters/plugins\": {\n            \"text\": \"/*\\\\\\r\\ntitle: $:/plugins/danielo515/tiddlypouch/converters/plugins\\r\\ntype: application/javascript\\r\\nmodule-type: library\\r\\n\\r\\nDecorator that convert tiddlywiki plugins into PouchDB documents\\r\\n\\r\\n@preserve\\r\\n\\r\\n\\\\*/\\r\\n\\r\\n'use strict'\\r\\n\\r\\n/*jslint node: true, browser: true */\\r\\n/*global $tw: false */\\r\\n/* global module */\\r\\n/** @namespace {converters} plugins.converter */\\r\\n\\r\\nmodule.exports.decorate = pluginConverter;\\r\\n\\r\\n/***====================== plugins conversor dependency  ========================== */\\r\\nvar BaseConverter = require('$:/plugins/danielo515/tiddlypouch/converters/converter.js')\\r\\n\\r\\n/**\\r\\n * Injects methods to handle conversions between regular TW tiddlers and CouchDB.\\r\\n * getSkinnyTiddlers is not implemented because it does not makes sense on the plugins database\\r\\n *\\r\\n * @param {DbStore} db - a database instance where methods should be injected\\r\\n * @return {DbStore} The same db with the methods already injected\\r\\n */\\r\\nfunction pluginConverter(db) {\\r\\n    /***===================== CONVERSIONS BETWEEN TW AND PouchDB ============= */\\r\\n\\r\\n    /** decorate with the base methods */\\r\\n    db = BaseConverter.decorate(db);\\r\\n\\r\\n    /**\\r\\n     * Copy all fields to \\\"fields\\\" except the \\\"revision\\\" field.\\r\\n     * See also: TiddlyWebAdaptor.prototype.convertTiddlerToTiddlyWebFormat.\\r\\n     *\\r\\n     * @param {Tiddler} tiddler - the tiddler to convert to CouchDB format\\r\\n     * @param {object} tiddlerInfo - The metadata about the tiddler that the sync mechanism of tiddlywiki provides.\\r\\n     *                               This includes the revision and other metadata related to the tiddler that is not\\r\\n     *                               included in the tiddler.\\r\\n     * @static\\r\\n     * @private\\r\\n     * @returns {object} doc - An document object that represents the tiddler. Ready to be inserted into CouchDB\\r\\n     */\\r\\n    db._convertToCouch = function convertToCouch(tiddler, tiddlerInfo) {\\r\\n        var result = { fields: {} };\\r\\n        if (tiddler) {\\r\\n            $tw.utils.each(tiddler.fields, function (element, field) {\\r\\n                if (field === \\\"revision\\\") { return; } // Skip revision\\r\\n                // Convert fields to string\\r\\n                result.fields[field] = tiddler.getFieldString(field);\\r\\n            });\\r\\n            // tags must stay as array, so fix it\\r\\n            result.fields.tags = tiddler.fields.tags;\\r\\n        }\\r\\n        // Default the content type\\r\\n        result.fields.type = result.fields.type || \\\"text/vnd.tiddlywiki\\\";\\r\\n        result._id = this._mangleTitle(tiddler.fields.title);\\r\\n        result._rev = tiddler.fields.revision; //Temporary workaround. Remove\\r\\n        if (tiddlerInfo.adaptorInfo && tiddlerInfo.adaptorInfo._rev) {\\r\\n            result._rev = tiddlerInfo.adaptorInfo._rev;\\r\\n        }\\r\\n        result._rev = this._validateRevision(result._rev);\\r\\n        return result;\\r\\n    };\\r\\n\\r\\n        /**\\r\\n         * Dummy method. TW should never try to load a plugin from the sync adaptor.\\r\\n         * Even if TW tries to lazy-load a plugin (because any error handling the tiddler)\\r\\n         * the router will route that request to the default DbStore\\r\\n         * @return {null} nothing is returned\\r\\n         */\\r\\n        db._convertFromCouch = function convertFromCouch() {\\r\\n            var err = new Error('Tiddlers should not be loaded from the plugins database!');\\r\\n            err.status = 403;\\r\\n            throw err\\r\\n        };\\r\\n\\r\\n        /**\\r\\n         * Dummy method.\\r\\n         * Tiddlers should never be deleted through the plugins DbStore\\r\\n         * Even if TW tries to delete a plugin (because any error handling the tiddler)\\r\\n         * the router will route that request to the default DbStore\\r\\n         * @return {null} nothing is returned\\r\\n         */\\r\\n        db.deleteTiddler = function() {\\r\\n            var err = new Error('Tiddlers should not be deleted through the plugins database!');\\r\\n            err.status = 403;\\r\\n            throw err\\r\\n        };\\r\\n\\r\\n        return db;\\r\\n}\",\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/converters/plugins\",\n            \"type\": \"application/javascript\",\n            \"module-type\": \"library\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/converters/tiddler\": {\n            \"text\": \"/*\\\\\\r\\ntitle: $:/plugins/danielo515/tiddlypouch/converters/tiddler\\r\\ntype: application/javascript\\r\\nmodule-type: library\\r\\n\\r\\na conversor that makes tiddlers compatible with pouchdb. This injects the required methods into the db store to handle conversions between regular tiddlers and couchdb\\r\\n\\r\\n@preserve\\r\\n\\r\\n\\\\*/\\r\\n\\r\\n'use strict'\\r\\n\\r\\n/*jslint node: true, browser: true */\\r\\n/*global $tw: false */\\r\\n/* global module */\\r\\n/** @namespace {converters} tiddler.converter */\\r\\n\\r\\nmodule.exports.decorate = tiddlerConverter;\\r\\n\\r\\n/***====================== Tiddler conversor dependency  ========================== */\\r\\nvar BaseConverter = require('$:/plugins/danielo515/tiddlypouch/converters/converter.js');\\r\\n\\r\\n/**\\r\\n * Injects methods to handle conversions between regular TW tiddlers and CouchDB\\r\\n *\\r\\n * @param {DbStore} db a database instance where methods should be injected\\r\\n * @return {DbStore} The same db with the methods already injected\\r\\n */\\r\\nfunction tiddlerConverter(db) {\\r\\n    /***===================== CONVERSIONS BETWEEN TW AND PouchDB ============= */\\r\\n\\r\\n    db = BaseConverter.decorate(db);\\r\\n\\r\\n    /**\\r\\n     * Copy all fields to \\\"fields\\\" sub-object except for the \\\"revision\\\" field.\\r\\n     * See also: TiddlyWebAdaptor.prototype.convertTiddlerToTiddlyWebFormat.\\r\\n     *\\r\\n     * @param {Tiddler} tiddler - the tiddler to convert to CouchDB format\\r\\n     * @param {object} tiddlerInfo - The metadata about the tiddler that the sync mechanism of tiddlywiki provides.\\r\\n     *                               This includes the revision and other metadata related to the tiddler that is not\\r\\n     *                               included in the tiddler.\\r\\n     * @static\\r\\n     * @private\\r\\n     * @returns {object} doc - An document object that represents the tiddler. Ready to be inserted into CouchDB\\r\\n     */\\r\\n    db._convertToCouch = function convertToCouch(tiddler, tiddlerInfo) {\\r\\n        var result = { fields: {} };\\r\\n        if (tiddler) {\\r\\n            $tw.utils.each(tiddler.fields, function (element, title, object) {\\r\\n                if (title === \\\"revision\\\") {\\r\\n                    /* do not store revision as a field */\\r\\n                    return;\\r\\n                }\\r\\n                if (title === \\\"_attachments\\\" && !tiddler.isDraft()) {\\r\\n                    //Since the draft and the original tiddler are not the same document\\r\\n                    //the draft does not has the attachments\\r\\n                    result._attachments = element; //attachments should be stored out of fields object\\r\\n                    return;\\r\\n                }\\r\\n                // Convert fields to string\\r\\n                result.fields[title] = tiddler.getFieldString(title);\\r\\n            });\\r\\n            // tags must stay as array, so fix it\\r\\n            result.fields.tags = tiddler.fields.tags;\\r\\n        }\\r\\n        // Default the content type\\r\\n        result.fields.type = result.fields.type || \\\"text/vnd.tiddlywiki\\\";\\r\\n        result._id = this._mangleTitle(tiddler.fields.title);\\r\\n        result._rev = tiddler.fields.revision; //Temporary workaround. Remove\\r\\n        if (tiddlerInfo.adaptorInfo && tiddlerInfo.adaptorInfo._rev) {\\r\\n            result._rev = tiddlerInfo.adaptorInfo._rev;\\r\\n        }\\r\\n        result._rev = this._validateRevision(result._rev);\\r\\n        return result;\\r\\n    };\\r\\n\\r\\n        /**\\r\\n         * Transforms a pouchd document extracting just the fields that should be\\r\\n         * part of the tiddler discarding all the metadata related to PouchDB.\\r\\n         * For this version just copy all fields across except _rev and _id\\r\\n         * @static\\r\\n         * @param {object} doc - A couchdb object containing a tiddler representation inside the fields sub-object\\r\\n         * @returns {object} fields ready for being added to a wiki store\\r\\n         */\\r\\n        db._convertFromCouch = function convertFromCouch(doc) {\\r\\n            var result = {};\\r\\n            this.logger && this.logger.debug(\\\"Converting from \\\", doc);\\r\\n            // Transfer the fields, pulling down the `fields` hashmap\\r\\n            $tw.utils.each(doc, function (element, field, obj) {\\r\\n                if (field === \\\"fields\\\") {\\r\\n                    $tw.utils.each(element, function (element, subTitle, obj) {\\r\\n                        result[subTitle] = element;\\r\\n                    });\\r\\n                } else if (field === \\\"_id\\\" || field === \\\"_rev\\\") {\\r\\n                    /* skip these */\\r\\n                } else {\\r\\n                    result[field] = doc[field];\\r\\n                }\\r\\n            });\\r\\n            result[\\\"revision\\\"] = doc[\\\"_rev\\\"];\\r\\n            //console.log(\\\"Conversion result \\\", result);\\r\\n            return result;\\r\\n        };\\r\\n\\r\\n/**\\r\\n * Returns an array of skinny tiddlers (tiddlers withouth text field)\\r\\n * They are converted from CouchDB documents to TW tiddlers.\\r\\n * It requires that a skinny_tiddlers view exists on the database.\\r\\n * Such index is created on the startup module startup-pouch, wich is probably a bad practice\\r\\n * @return {promise} Skinnytiddlers a promise that fulfills to an array of skinny tiddlers\\r\\n */\\r\\n    db.getSkinnyTiddlers = function () {\\r\\n       return this.getTiddlers('skinny_tiddlers',null,false)\\r\\n    };\\r\\n\\r\\n    return db;\\r\\n}\",\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/converters/tiddler\",\n            \"type\": \"application/javascript\",\n            \"module-type\": \"library\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/images/revisions\": {\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/images/revisions\",\n            \"text\": \"<svg class=\\\"tc-image-file tc-image-button\\\" width=\\\"22pt\\\" height=\\\"22pt\\\" viewBox=\\\"-12 0 128 128\\\">\\r\\n <g>\\r\\n  <path stroke-opacity=\\\"0\\\" id=\\\"svg_18\\\" d=\\\"m8,125.96423l84,1l2,-95l-25,-25l-60,2l-1,117z\\\" stroke-linecap=\\\"square\\\" stroke-linejoin=\\\"round\\\" stroke-dasharray=\\\"null\\\" stroke-width=\\\"4\\\" stroke=\\\"#000000\\\"/>\\r\\n  <g id=\\\"svg_1\\\" fill-rule=\\\"nonzero\\\">\\r\\n   <path d=\\\"m98.96811,33.5l0.03189,0l0,89.49908c0,4.41879 -3.58089,8.00092 -7.99925,8.00092l-80.0015,0c-4.41787,0 -7.99925,-3.58231 -7.99925,-8.00092l0,-111.99816c0,-4.41879 3.58089,-8.00092 7.99925,-8.00092l57.00075,0l0,0.02018c2.15899,-0.09171 4.34822,0.6869 5.99825,2.33693l22.62693,22.62693c1.5265,1.5265 2.30776,3.5158 2.34293,5.51596l0,0zm-30.96811,-22.5l-57,0l0,112l80,0l0,-89.5l-14.99965,0c-4.41847,0 -8.00035,-3.57837 -8.00035,-8.00035l0,-14.49965z\\\" id=\\\"svg_2\\\" />\\r\\n   <text stroke-opacity=\\\"0\\\" fill=\\\"#ffffff\\\" x=\\\"43.25633\\\" y=\\\"54.82153\\\" id=\\\"svg_9\\\" font-size=\\\"24\\\" font-family=\\\"Sans-serif\\\" text-anchor=\\\"middle\\\" xml:space=\\\"preserve\\\" transform=\\\"matrix(3.5430981263433354,0,0,3.1603711640014467,-102.24349149601478,-63.365374592008266) \\\" stroke=\\\"#000000\\\" stroke-linejoin=\\\"round\\\" stroke-linecap=\\\"round\\\" font-weight=\\\"bold\\\">R</text>\\r\\n   <rect stroke=\\\"#000000\\\" stroke-opacity=\\\"0\\\" fill=\\\"#ffffff\\\" x=\\\"19\\\" y=\\\"39\\\" width=\\\"64\\\" height=\\\"8\\\" rx=\\\"4\\\" id=\\\"svg_3\\\"/>\\r\\n   <rect stroke-opacity=\\\"0\\\" stroke=\\\"#000000\\\" fill=\\\"#ffffff\\\" x=\\\"19\\\" y=\\\"23\\\" width=\\\"40\\\" height=\\\"8\\\" rx=\\\"4\\\" id=\\\"svg_8\\\"/>\\r\\n  </g>\\r\\n </g>\\r\\n</svg>\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/images/cloud-error\": {\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/images/cloud-error\",\n            \"text\": \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" version=\\\"1.1\\\" x=\\\"0\\\" y=\\\"0\\\"\\r\\n    width=\\\"23\\\" height=\\\"23\\\" viewBox=\\\"0 0 512 512\\\" enable-background=\\\"new 0 0 512 512\\\"\\r\\n    xml:space=\\\"preserve\\\">\\r\\n<path d=\\\"M446.3 208.8C447 203.3 448 197.8 448 192c0-70.7-57.3-128-128-128 -41.8 0-78.6 20.3-101.9 51.4C209.7 113.3 201 112 192 112c-61.9 0-112 50.1-112 112 0 1.8 0.4 3.3 0.5 5.1C34.1 242.7 0 285.2 0 336c0 61.9 50.1 112 112 112h272c70.7 0 128-57.3 128-128C512 272.1 485.3 230.8 446.3 208.8zM346.5 333.3l-45.2 45.3L256 333.3l-45.2 45.3 -45.3-45.2L210.8 288l-45.3-45.2 45.3-45.2L256 242.8l45.3-45.2 45.3 45.3L301.3 288 346.5 333.3z\\\"/>\\r\\n</svg>\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/images/cloud-ok\": {\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/images/cloud-ok\",\n            \"text\": \"<svg version=\\\"1.1\\\" id=\\\"Layer_1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\" x=\\\"0px\\\" y=\\\"0px\\\"\\r\\n\\t width=\\\"22pt\\\" height=\\\"22pt\\\" viewBox=\\\"0 0 512 512\\\" enable-background=\\\"new 0 0 512 512\\\" xml:space=\\\"preserve\\\">\\r\\n<path d=\\\"M319.99,64.012c-41.799,0-78.862,20.378-102.26,51.478-8.3011-2.0992-16.739-3.4783-25.739-3.4783-61.901,0-112,50.1-112,112,0,1.8009-0.08904,3.7652,0,5.5652-46.401,13.6-80,55.635-80,106.43,0,61.9,50.099,112,112,112h272c70.701,0,128-57.3,128-128,0-47.9-27.086-88.609-66.087-110.61,0.71235-5.5,2.0858-11.591,2.0858-17.391,0-70.7-57.299-128-128-128zm79.304,81.391c5.2538-0.001,9.9054,2.1682,13.913,6.2609,7.9992,8.1706,8.0168,21.029,0,29.217l-198.94,203.83c-4.0067,4.0927-9.3542,6.2604-14.609,6.2609-5.2609,0.002-10.594-2.1615-14.609-6.2609l-86.953-88.36c-8.0375-8.2098-8.0155-21.726,0-29.913,7.9992-8.1706,20.498-8.196,28.522,0l73.043,73.739,185.04-188.52c4.0063-4.0922,9.3549-6.2598,14.609-6.2609z\\\"/>\\r\\n</svg>\\r\\n\\r\\n\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/images/cloud-spinning\": {\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/images/cloud-spinning\",\n            \"text\": \"<svg version=\\\"1.1\\\" id=\\\"Layer_1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\" x=\\\"0px\\\" y=\\\"0px\\\"\\r\\n\\t width=\\\"22pt\\\" height=\\\"22pt\\\" viewBox=\\\"0 0 512 512\\\" enable-background=\\\"new 0 0 512 512\\\" xml:space=\\\"preserve\\\">\\r\\n<path d=\\\"M446.313,208.813C447.031,203.25,448,197.75,448,192c0-70.688-57.281-128-128-128c-41.813,0-78.594,20.344-101.938,51.375\\r\\n\\tC209.656,113.344,201,112,192,112c-61.875,0-112,50.125-112,112c0,1.75,0.438,3.313,0.5,5.063C34.094,242.719,0,285.156,0,336\\r\\n\\tc0,61.875,50.125,112,112,112h272c70.719,0,128-57.281,128-128C512,272.063,485.344,230.75,446.313,208.813z M128,288h32\\r\\n\\tc0-52.938,43.063-96,96-96c19,0,37.094,5.625,52.344,15.531l-19.438,25.906c-9.766-5.875-21-9.438-32.906-9.438\\r\\n\\tc-35.297,0-64,28.688-64,64h32l-48,64L128,288z M352,288c0,52.938-43.063,96-96,96c-19,0-37.078-5.625-52.359-15.531l19.438-25.906\\r\\n\\tC232.859,348.438,244.094,352,256,352c35.281,0,64-28.688,64-64h-32l48-64l48,64H352z\\\"/>\\r\\n</svg>\\r\\n\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/utils/logger.js\": {\n            \"text\": \"/*\\\\\\r\\ntitle: $:/plugins/danielo515/tiddlypouch/utils/logger.js\\r\\ntype: application/javascript\\r\\nmodule-type: library\\r\\nA basic logging implementation\\r\\n\\r\\n@preserve\\r\\n\\r\\n\\\\*/\\r\\n\\r\\n(function(){\\r\\n\\r\\n/*jslint node: true, browser: true */\\r\\n/*global $tw: false */\\r\\n\\\"use strict\\\";\\r\\n\\r\\nvar Super = require('$:/core/modules/utils/logger.js').Logger;\\r\\n\\r\\n/**\\r\\n* Make a new logger\\r\\n* @class\\r\\n* @param {String} componentName - This will be displayed on the logging messages as header\\r\\n* @param {Object|boolean} debug - A debug config object with debug and verbose booleans or a boolean indicating that debug level is active\\r\\n* @param {boolean} verbose - if verbose debug level is active (used on trace method)\\r\\n*\\r\\n*/\\r\\nfunction Logger(componentName, debug , verbose ) {\\r\\n    Super.call(this,componentName);\\r\\n\\r\\n    if( typeof debug === \\\"object\\\" ){\\r\\n        verbose = debug.verbose;\\r\\n        debug = debug.debug\\r\\n    }\\r\\n    this.isDebug = debug;\\r\\n    this.isVerbose = verbose;\\r\\n}\\r\\n\\r\\nLogger.prototype = Object.create(Super.prototype);\\r\\nLogger.prototype.constructor = Super;\\r\\n\\r\\n/**\\r\\n * Log only if there is debug enabled\\r\\n * @returns {undefined} returns nothing\\r\\n */\\r\\nLogger.prototype.debug = function(){\\r\\n    if(!this.isDebug){\\r\\n        return \\r\\n    }\\r\\n    this.log.apply(this, Array.prototype.slice.call(arguments,0))\\r\\n}\\r\\n\\r\\n/**\\r\\n * Log only if debug is verbose\\r\\n * @returns {undefined} returns nothing\\r\\n */\\r\\nLogger.prototype.trace = function(){\\r\\n    if(!this.isVerbose){\\r\\n        return \\r\\n    }\\r\\n    this.debug.apply(this, Array.prototype.slice.call(arguments,0))\\r\\n}\\r\\n\\r\\nexports.Logger = Logger;\\r\\n\\r\\n}());\",\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/utils/logger.js\",\n            \"type\": \"application/javascript\",\n            \"module-type\": \"library\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/pouchadaptor.js\": {\n            \"text\": \"/*\\\\\\r\\ntitle: $:/plugins/danielo515/tiddlypouch/pouchadaptor.js\\r\\ntype: application/javascript\\r\\nmodule-type: syncadaptor\\r\\n\\r\\nA sync adaptor module for synchronising with local PouchDB\\r\\n\\r\\n\\r\\n@preserve\\r\\n\\r\\n\\\\*/\\r\\n\\r\\n\\r\\n/*jslint node: false, browser: true */\\r\\n/*global $tw: false, XMLHttpRequest: false */\\r\\n\\\"use strict\\\";\\r\\n\\r\\n\\r\\n/**\\r\\n * Creates the pouch sync adaptor \\r\\n * @constructor \\r\\n * @param {any} options\\r\\n */\\r\\nfunction PouchAdaptor(options) {\\r\\n    this.wiki = options.wiki;\\r\\n    var Debug = $TPouch.config.debug;\\r\\n    this.logger = new $TPouch.Logger(\\\"PouchAdaptor\\\", Debug.isActive(), Debug.isVerbose() );\\r\\n    this.sessionUrl = $TPouch.config.currentDB.getUrl(\\\"_session\\\"); // save the URL on startup\\r\\n    //this.readConfig()\\r\\n}\\r\\n\\r\\n/**\\r\\n* Copied from TiddlyWiki5 core/modules/utils/dom/http.js to add support for xhr.withCredentials\\r\\n*/\\r\\nfunction httpRequest(options) {\\r\\n    var type = options.type || \\\"GET\\\",\\r\\n        headers = options.headers || { accept: \\\"application/json\\\" },\\r\\n        request = new XMLHttpRequest(),\\r\\n        data = \\\"\\\",\\r\\n        results;\\r\\n    // Massage the data hashmap into a string\\r\\n    if (options.data) {\\r\\n        if (typeof options.data === \\\"string\\\") { // Already a string\\r\\n            data = options.data;\\r\\n        } else { // A hashmap of strings\\r\\n            results = [];\\r\\n            $tw.utils.each(options.data, function (dataItem, dataItemTitle) {\\r\\n                results.push(dataItemTitle + \\\"=\\\" + encodeURIComponent(dataItem));\\r\\n            });\\r\\n            data = results.join(\\\"&\\\");\\r\\n        }\\r\\n    }\\r\\n    // for CORS if required\\r\\n    if (options.withCredentials) {\\r\\n        request.withCredentials = true;\\r\\n    }\\r\\n    // Set up the state change handler\\r\\n    request.onreadystatechange = function () {\\r\\n        if (this.readyState === 4) {\\r\\n            if (this.status === 200 || this.status === 201 || this.status === 204) {\\r\\n                // Success!\\r\\n                options.callback(null, this.responseText, this);\\r\\n                return;\\r\\n            }\\r\\n            // Something went wrong\\r\\n            options.callback(\\\"XMLHttpRequest error code: \\\" + this.status);\\r\\n        }\\r\\n    };\\r\\n    // Make the request\\r\\n    request.open(type, options.url, true);\\r\\n    if (headers) {\\r\\n        $tw.utils.each(headers, function (header, headerTitle, object) {\\r\\n            request.setRequestHeader(headerTitle, header);\\r\\n        });\\r\\n    }\\r\\n    if (data && !$tw.utils.hop(headers, \\\"Content-type\\\")) {\\r\\n        request.setRequestHeader(\\\"Content-type\\\", \\\"application/x-www-form-urlencoded; charset=UTF-8\\\");\\r\\n    }\\r\\n    request.send(data);\\r\\n    return request;\\r\\n}\\r\\n\\r\\n/**\\r\\nReverse what mangleTitle does. Used to obtain title from _id (in convertFromSkinnyTiddler).\\r\\n This is legacy code, but I don't want to get rid of it'\\r\\nPouchAdaptor.prototype.demangleTitle = function (title) {\\r\\n    if (title.length < 3) {\\r\\n        return title;\\r\\n    }\\r\\n    var firstThree = title.substring(0, 3);\\r\\n    var restOfIt = title.substring(3);\\r\\n    if (firstThree === '%5f') {\\r\\n        return '_' + restOfIt;\\r\\n    }\\r\\n    else if (firstThree === '%25') {\\r\\n        return '%' + restOfIt;\\r\\n    }\\r\\n    else {\\r\\n        return title;\\r\\n    }\\r\\n}*/\\r\\n\\r\\n/*****************************************************\\r\\n ****** Tiddlywiki required methods\\r\\n *****************************************************/\\r\\n\\r\\nPouchAdaptor.prototype.getStatus = function (callback) {\\r\\n    var self = this;\\r\\n    if (!self.sessionUrl) {\\r\\n        return callback(null, false, \\\"NON-AUTHENTICATED\\\")\\r\\n    }\\r\\n    httpRequest({\\r\\n        url: self.sessionUrl,\\r\\n        withCredentials: true,\\r\\n        callback: function (err, data) {\\r\\n            if (err) {\\r\\n                return callback(err);\\r\\n            }\\r\\n            var json = null;\\r\\n            var isLoggedIn = false;\\r\\n            var username = null;\\r\\n            try {\\r\\n                json = JSON.parse(data);\\r\\n            } catch (e) {\\r\\n            }\\r\\n            if (json && json.userCtx) {\\r\\n                username = json.userCtx.name;\\r\\n                isLoggedIn = (username !== null);\\r\\n                if (!isLoggedIn && json.userCtx.roles.length == 1 && json.userCtx.roles[0] === '_admin') {\\r\\n                    // admin party mode\\r\\n                    self.logger('Warning! Server is on admin party mode!')\\r\\n                    isLoggedIn = true;\\r\\n                }\\r\\n            }\\r\\n            // If we are logged but there is no onlineDB means that there is a cookie\\r\\n            // We have to create the database which will pick up the cookie.\\r\\n            // TW will not call the login method if we are already logged in, even if the user clicks on login.\\r\\n            if (isLoggedIn && !$TPouch.onlineDB) {\\r\\n                self.login(); // this creates the online database\\r\\n            }\\r\\n            callback(null, isLoggedIn, username);\\r\\n        }\\r\\n    });\\r\\n}\\r\\n\\r\\nPouchAdaptor.prototype.getTiddlerInfo = function (tiddler) {\\r\\n    return { _rev: tiddler.fields.revision };\\r\\n};\\r\\n\\r\\n/**\\r\\n * Returns an array of skinny tiddlers (tiddlers withouth text field)\\r\\n * @param {function} callback callback to call with the converted tiddlers\\r\\n * @return {promise} Skinnytiddlers a promise that fulfills to an array of skinny tiddlers\\r\\n */\\r\\nPouchAdaptor.prototype.getSkinnyTiddlers = function (callback) {\\r\\n    $TPouch.database.getSkinnyTiddlers()\\r\\n    .then(callback.bind(null,null))\\r\\n    .catch(callback);\\r\\n};\\r\\n\\r\\n/**\\r\\n * Saves a tiddler to the current db store\\r\\n * @param  {Tiddler} tiddler - instance of $tw.Tiddler to be converted \\r\\n * @param  {function} callback - the callback that should be called when the operation completes\\r\\n * @param  {object} options - the options that the syncer provides, fo rexample tiddlerInfo metadata\\r\\n * @return {undefined} this does not returns anything\\r\\n */\\r\\nPouchAdaptor.prototype.saveTiddler = function (tiddler, callback, options) {\\r\\n    this.logger.trace(\\\"Tiddler info \\\",options.tiddlerInfo);\\r\\n    $TPouch.router.route(tiddler,options).addTiddler(tiddler,options)\\r\\n        .then(function (saveInfo) {\\r\\n            callback(null, { _rev: saveInfo.rev }, saveInfo.rev);\\r\\n        })\\r\\n        .catch(callback);\\r\\n};\\r\\n\\r\\nPouchAdaptor.prototype.loadTiddler = function (title, callback) {\\r\\n   $TPouch.database.getTiddler(title)\\r\\n   .then( callback.bind(null,null)) // callback with null as error\\r\\n   .catch( callback );\\r\\n};\\r\\n\\r\\nPouchAdaptor.prototype.deleteTiddler = function (title, callback, options) {\\r\\n    if (!options.tiddlerInfo || !options.tiddlerInfo.adaptorInfo || typeof options.tiddlerInfo.adaptorInfo._rev == \\\"undefined\\\") {\\r\\n        /* not on server, just return OK */\\r\\n        callback(null);\\r\\n    }\\r\\n    $TPouch.database.deleteTiddler(title)\\r\\n    .then(callback.bind(callback,null))\\r\\n    .catch(callback);\\r\\n};\\r\\n\\r\\nPouchAdaptor.prototype.isReady = function () {\\r\\n    // Since pouchdb handles the sync to the server we declare ourselves allways ready.\\r\\n    return true;\\r\\n};\\r\\n\\r\\n\\r\\nPouchAdaptor.prototype.login = function (username, password, callback) {\\r\\n    var self = this;\\r\\n    self.logger.log('Trying to sync...');\\r\\n\\r\\n    var onlineDB = $TPouch.newOnlineDB({ username: username, password: password });\\r\\n    if (!onlineDB) {\\r\\n        self.logger.log(\\\"Warning, sync is not possible because no onlineDB\\\");\\r\\n        return callback('There is no online DB set');\\r\\n    }\\r\\n    $TPouch.onlineDB = onlineDB;\\r\\n    $TPouch.startSync(onlineDB).then(callback);\\r\\n}\\r\\n\\r\\nPouchAdaptor.prototype.logout = function (callback) {\\r\\n    var self = this;\\r\\n    var options = {\\r\\n        url: self.sessionUrl,\\r\\n        type: \\\"DELETE\\\",\\r\\n        withCredentials: true,\\r\\n        callback: function (err) {\\r\\n            callback(err);\\r\\n        }\\r\\n    };\\r\\n    httpRequest(options);\\r\\n}\\r\\n\\r\\n//--- END TEMPT COMMENT */\\r\\n\\r\\nif ($tw.browser && $TPouch.database) {\\r\\n    /*Only works if we are on browser and there is a database*/\\r\\n    exports.adaptorClass = PouchAdaptor;\\r\\n}\\r\\n\",\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/pouchadaptor.js\",\n            \"type\": \"application/javascript\",\n            \"module-type\": \"syncadaptor\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/readme\": {\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/readme\",\n            \"text\": \"This is tiddlypouch plugin for [[TiddlyWiki|tiddlywiki.com]].\\r\\nThis plugin uses PouchDB library to provide a store for your tiddlers. \\r\\nTiddlers are saved to the built-in database of your browser. It is also possible to setup a remote\\r\\ndatabase and make tiddlypouch sync your local database with the remote one! This allows you very\\r\\ninteresting workflows like ''working offline'' and syn back to the server when you come back online.\\r\\n\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/database/router.js\": {\n            \"text\": \"/*\\\\\\r\\ntitle: $:/plugins/danielo515/tiddlypouch/database/router.js\\r\\ntype: application/javascript\\r\\nmodule-type: library\\r\\n\\r\\nRoutes tiddlers between databases. What it actually does is return the destination database for a given tiddler.\\r\\nIt is the responsability of the entity that is requesting the routing to act on that destination.\\r\\n\\r\\n@preserve\\r\\n\\r\\n\\\\*/\\r\\n\\r\\n'use strict';\\r\\n\\r\\n/*jslint node: true, browser: true */\\r\\n\\r\\n/***====================== EXPORTS  ========================== */\\r\\n\\r\\nmodule.exports = DbRouter;\\r\\n\\r\\n\\r\\n\\r\\n/***====================== DEFAULT ROUTE  ========================== */\\r\\n\\r\\nfunction defaultRouter(tiddler){\\r\\n    if( this.destinations.default ){\\r\\n            return 'default';\\r\\n        }\\r\\n    throw new Error('There is no default route set!')\\r\\n}\\r\\n\\r\\nvar defaultRoute = {\\r\\n    name: 'default',\\r\\n    canRoute: function(){ return true },\\r\\n    route: defaultRouter\\r\\n};\\r\\n\\r\\n/**\\r\\n * Route interface.\\r\\n * Routes used with the {@link DbRouter} class should implement this interface.\\r\\n * All route methods are called with their `this` context pointing to the DbRouter instance they belong to\\r\\n *\\r\\n * @interface Route\\r\\n */\\r\\n/**\\r\\n *\\r\\n *\\r\\n * @function\\r\\n * @name Route#canRoute\\r\\n * @param {object} Tiddler - The tiddler to be routed\\r\\n * @returns {boolean} true if this route is capable of routing the given tiddler. False otherwhise\\r\\n */\\r\\n/**\\r\\n *\\r\\n *\\r\\n * @function\\r\\n * @name Route#route\\r\\n * @param {object} Tiddler - The tiddler to be routed\\r\\n * @param {object} destinations - The hasmap of destinations that the current @DbRouter has\\r\\n * @returns {string} The name of the destination database. Will be used by @DbRouter to find it on the map of destinations\\r\\n */\\r\\n\\r\\n/**\\r\\n *\\r\\n * Creates a new instance of the databases router.\\r\\n * It is responsible of returning a valid db destination for a given tiddler.\\r\\n * The caller should know what to do with the returned database, it is out of the scope of this Class.\\r\\n * @class\\r\\n *\\r\\n * @param {any} defaultDb - The database used as fallback if there is no route that can route the current tiddler\\r\\n * @return {null} This should be called with the new operator.\\r\\n */\\r\\nfunction DbRouter ( defaultDb ){\\r\\n    this.destinations = {'default': defaultDb };\\r\\n    this.routes = [ defaultRoute ];\\r\\n}\\r\\n\\r\\n/**\\r\\n * Factory method for instantiating constructors\\r\\n * @name DbRouter#createRouter\\r\\n * @static\\r\\n */\\r\\nDbRouter.createRouter = function( defaultDb ){\\r\\n    return new DbRouter(defaultDb);\\r\\n}\\r\\n\\r\\n/**\\r\\n * Adds a route at the ond of the routes array.\\r\\n * It checks that the route conforms with the required API (AKA interface)\\r\\n * @param {object} route - The route to add to the list of routes. Should implement the  {@link Route} interface\\r\\n * @return {DbRouter} - a reference to the current router for method chaining.\\r\\n */\\r\\nDbRouter.prototype.addRoute = function( route ){\\r\\n    if( (typeof route === 'object') && ( typeof route.canRoute === 'function' ) && (typeof route.route === 'function') ) {\\r\\n        this.routes.push(route);\\r\\n        return this\\r\\n    }\\r\\n\\r\\n    var err = new Error('Invalid route. Routes should include \\\"canRoute\\\" and \\\"route\\\" methods');\\r\\n    throw err;\\r\\n};\\r\\n\\r\\n/**\\r\\n * Adds a destination to the map of destinations\\r\\n * @param {any} database - A database instance\\r\\n * @param {string} name - The name the database will have in the destinations map. It can override any existing destination.\\r\\n * @return {DbRouter} a reference to the current router for method chaining\\r\\n */\\r\\nDbRouter.prototype.addDestination = function ( name , database ){\\r\\n    this.destinations[name] = database;\\r\\n    return this;\\r\\n}\\r\\n\\r\\nDbRouter.prototype.findRoute = function ( tiddler ){\\r\\n    for(var i = this.routes.length-1; i>-1; --i ) {\\r\\n        var route = this.routes[i];\\r\\n        if(route.canRoute.call(this,tiddler)){\\r\\n            return route\\r\\n        }\\r\\n    }\\r\\n}\\r\\n\\r\\nDbRouter.prototype.route = function(tiddler){\\r\\n    var route = this.findRoute(tiddler);\\r\\n    var dest = route.route.call(this,tiddler);\\r\\n    return this.destinations[dest];\\r\\n}\\r\\n\\r\\n\",\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/database/router.js\",\n            \"type\": \"application/javascript\",\n            \"module-type\": \"library\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/database/routes\": {\n            \"text\": \"/*\\\\\\r\\ntitle: $:/plugins/danielo515/tiddlypouch/database/routes\\r\\ntype: application/javascript\\r\\nmodule-type: library\\r\\n\\r\\nsome routes for the DbRouter class\\r\\n\\r\\n@preserve\\r\\n\\r\\n\\\\*/\\r\\n\\r\\n'use strict'\\r\\n\\r\\n/*jslint node: true, browser: true */\\r\\n\\r\\nmodule.exports.plugins = {\\r\\n    name: \\\"plugins\\\" ,\\r\\n    route: function(tiddler){\\r\\n        return '__TP_plugins';\\r\\n    },\\r\\n    canRoute: function(tiddler){\\r\\n        return tiddler && tiddler.isPlugin && tiddler.isPlugin();\\r\\n    }\\r\\n}\",\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/database/routes\",\n            \"type\": \"application/javascript\",\n            \"module-type\": \"library\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/savers/DownloadCurrentDB\": {\n            \"text\": \"/*\\\\\\r\\ntitle: $:/plugins/danielo515/tiddlypouch/savers/DownloadCurrentDB\\r\\ntype: application/javascript\\r\\nmodule-type: saver\\r\\n\\r\\nSaves all the tiddlers on the current database as JSON\\r\\n\\r\\n@preserve \\r\\n\\r\\n\\\\*/\\r\\n(function () {\\r\\n\\r\\n    /*jslint node: true, browser: true */\\r\\n    /*global $tw: false, Promise */\\r\\n    \\\"use strict\\\";\\r\\n\\r\\n    var Utils = require('$:/plugins/danielo515/tiddlypouch/utils');\\r\\n\\r\\n    /**\\r\\n     * @constructor {type} DownloadCurrentDB\\r\\n    *  Select the appropriate saver module and set it up\\r\\n    */\\r\\n    function DownloadCurrentDB(wiki) {\\r\\n        this.downloader = require(\\\"$:/core/modules/savers/download.js\\\").create(wiki);\\r\\n    }\\r\\n\\r\\n    DownloadCurrentDB.prototype.save = function (text, method, callback) {\\r\\n        var options = {\\r\\n            variables:\\r\\n            {\\r\\n                filename: $TPouch.config.currentDB.getName() + '.json'\\r\\n            }\\r\\n        }\\r\\n        var allTiddlers = [];\\r\\n        var self = this;\\r\\n        // There is no other way to get all the documents except the desig ones http://stackoverflow.com/a/25744823/1734815\\r\\n        Promise.all([ /** get all documents except the design ones */\\r\\n            $TPouch.database._db.allDocs({include_docs: true, endkey: '_design'}),\\r\\n            $TPouch.database._db.allDocs({include_docs: true, startkey: '_design\\\\uffff'})\\r\\n            ])\\r\\n            .then(function(allDocuments){\\r\\n                return allDocuments[0].rows.concat(allDocuments[1].rows)\\r\\n            }) \\r\\n            .then(function (allDocuments) {\\r\\n                allDocuments.forEach(function (row) {\\r\\n                    allTiddlers.push($TPouch.database._convertFromCouch(row.doc))\\r\\n                });\\r\\n                var toDownload = JSON.stringify(allTiddlers, null, $tw.config.preferences.jsonSpaces);\\r\\n                self.downloader.save(toDownload, method, callback, options)\\r\\n            });\\r\\n        /**Stop other savers from trying to download the wiki */\\r\\n        return true\\r\\n    };\\r\\n\\r\\n\\r\\n    /**\\r\\n    * Information about this saver\\r\\n    */\\r\\n    DownloadCurrentDB.prototype.info = {\\r\\n        name: \\\"Download current db\\\",\\r\\n        priority: 100,\\r\\n        capabilities: [\\\"save\\\", \\\"download\\\"]\\r\\n    };\\r\\n\\r\\n    /**\\r\\n    * Static method that returns true if this saver is capable of working\\r\\n    */\\r\\n    exports.canSave = function (wiki) {\\r\\n        return $TPouch.database !== undefined\\r\\n    };\\r\\n\\r\\n    /**\\r\\n    * Create an instance of this saver\\r\\n    */\\r\\n    exports.create = function (wiki) {\\r\\n        return new DownloadCurrentDB(wiki);\\r\\n    };\\r\\n\\r\\n})();\",\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/savers/DownloadCurrentDB\",\n            \"type\": \"application/javascript\",\n            \"module-type\": \"saver\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/config/single-db-config\": {\n            \"text\": \"/*\\\\\\r\\ntitle: $:/plugins/danielo515/tiddlypouch/config/single-db-config\\r\\ntype: application/javascript\\r\\nmodule-type: library\\r\\n\\r\\n\\r\\n@preserve\\r\\n\\r\\n\\\\*/\\r\\n\\r\\n/*jslint node: true, browser: true */\\r\\n/*global module: false */\\r\\n\\r\\n/*** Exports **********************************/\\r\\nmodule.exports = dbConfig;\\r\\n\\r\\n/***************************** CODE ********************************/\\r\\n\\r\\n/**\\r\\n * \\r\\n * @constructor\\r\\n * @param {String|Object} name  The name of the database. This can also be a complete \\r\\n *                              config object for the new database\\r\\n * @param {Object} remote\\r\\n */\\r\\nfunction dbConfig(name, remote) {\\r\\n    if( typeof name === 'object' ){\\r\\n        remote = name.remote;\\r\\n        name = name.name;\\r\\n    }\\r\\n    this.name = name;\\r\\n    this.remote = {};\\r\\n    if (typeof remote === 'object') {\\r\\n        /** We only copy valid values, not the full object */\\r\\n        this.remote.name = remote.name;\\r\\n        this.remote.url = remote.url;\\r\\n        this.remote.username = remote.username;\\r\\n    }\\r\\n}\\r\\n\\r\\n/**\\r\\n * @return {String} name the name of the database\\r\\n */\\r\\ndbConfig.prototype.getName = function () {\\r\\n    return this.name;\\r\\n}\\r\\n\\r\\n/**\\r\\n * @return {String} remoteName the name this database has on the remote couchdb server\\r\\n */\\r\\ndbConfig.prototype.getRemoteName = function() {\\r\\n    var name = this.remote && this.remote.name;\\r\\n    return name;\\r\\n}\\r\\n\\r\\n/**\\r\\n * @return {Object} config A copy of the current configuration\\r\\n */\\r\\ndbConfig.prototype.getConfig = function () {\\r\\n    return {\\r\\n        name: this.name,\\r\\n        remote: this.remote\\r\\n    }\\r\\n}\\r\\n\\r\\n/**\\r\\n * @param {String} section Optional sub path of the remote server. For example _session\\r\\n * @return {String} URL The url of the remote server. Pointing to section if it is defined\\r\\n */\\r\\ndbConfig.prototype.getUrl = function getUrl(section) {\\r\\n    var URL = this.remote.url;\\r\\n    if (!URL) { return null }\\r\\n    URL = URL.substr(-1) === '/' ? URL : URL + '/'; //Make sure it ends with slash\\r\\n    if (section) {\\r\\n        URL += section;\\r\\n    }\\r\\n    return URL;\\r\\n\\r\\n}\\r\\n\\r\\n\",\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/config/single-db-config\",\n            \"type\": \"application/javascript\",\n            \"module-type\": \"library\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/startup/remove-splash.js\": {\n            \"text\": \"/*\\\\\\r\\ntitle: $:/plugins/danielo515/tiddlypouch/startup/remove-splash.js\\r\\ntype: application/javascript\\r\\nmodule-type: startup\\r\\n\\r\\nThe only purpose of this startup module is removing the splash screen.\\r\\nWe do it on a startup module that is executed as later as possible on the\\r\\nboot process, so we remove the loading message when the wiki has loaded fully,\\r\\nand not before.\\r\\n\\r\\n@preserve\\r\\n\\r\\n\\\\*/\\r\\n\\r\\n\\r\\n\\r\\n/*jslint node: true, browser: true */\\r\\n/*global $tw: false */\\r\\n\\\"use strict\\\";\\r\\n\\r\\n// Export name and synchronous status\\r\\nexports.name = \\\"TiddlyPouch-remove-splash\\\";\\r\\nexports.after = [\\\"startup\\\"];\\r\\nexports.platforms = [\\\"browser\\\"];\\r\\nexports.synchronous = true;\\r\\n\\r\\n\\r\\n\\r\\n/**\\r\\n * @module config-startup\\r\\n */\\r\\nexports.startup = function () {\\r\\n    $TPouch.splashScreen.hide();\\r\\n}\\r\\n\",\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/startup/remove-splash.js\",\n            \"type\": \"application/javascript\",\n            \"module-type\": \"startup\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/startup/config.js\": {\n            \"text\": \"/*\\\\\\r\\ntitle: $:/plugins/danielo515/tiddlypouch/startup/config.js\\r\\ntype: application/javascript\\r\\nmodule-type: startup\\r\\n\\r\\nModule responsible of managing the config.\\r\\nCreates and reads the config database.\\r\\nProvides an interface to the configurations (get, set, update)\\r\\nConfiguration should be inmutable and require a reboot to become active\\r\\nOnly remote configuration (username, remote_name, url) may be changed in the running session.\\r\\n\\r\\n@preserve\\r\\n\\r\\n\\\\*/\\r\\n\\r\\n(function () {\\r\\n\\r\\n    /*jslint node: true, browser: true */\\r\\n    /*global $tw: false */\\r\\n    \\\"use strict\\\";\\r\\n\\r\\n    // Export name and synchronous status\\r\\n    exports.name = \\\"TiddlyPouch-config\\\";\\r\\n    exports.before = [\\\"pouchdb\\\"];\\r\\n    exports.platforms = [\\\"browser\\\"];\\r\\n    exports.synchronous = false;\\r\\n\\r\\n    var CONFIG_PREFIX = \\\"$:/plugins/danielo515/tiddlypouch/config/\\\";\\r\\n    var CONFIG_TIDDLER = CONFIG_PREFIX + \\\"config_database\\\";\\r\\n\\r\\n\\r\\n    /**\\r\\n     * @module config-startup\\r\\n     */\\r\\n    exports.startup = function (callback) {\\r\\n        var LOGGER = require('$:/plugins/danielo515/tiddlypouch/utils/logger.js', true).Logger;\\r\\n        var Logger = new LOGGER(\\\"TiddlyPouch:config\\\");\\r\\n        var Ui = require(\\\"$:/plugins/danielo515/tiddlypouch/ui/config.js\\\");\\r\\n        var SingleConfig = require(\\\"$:/plugins/danielo515/tiddlypouch/config/single-db-config\\\");\\r\\n        var _config; // debug { active, verbose }, selectedDbId, databases\\r\\n        var _configDB; // where the _config is persisted to \\r\\n        var currentDB; // name, remote { url, user } Only configs!, not the actual db\\r\\n\\r\\n        /*==== TIDDLER METHODS === */\\r\\n\\r\\n        function _readConfigTiddler() {\\r\\n            var configDefault = {\\r\\n                debug: { active: true, verbose: false },\\r\\n                selectedDbId: 'MyNotebook',\\r\\n                databases: {},\\r\\n            };\\r\\n            var config;\\r\\n            try {\\r\\n                config = JSON.parse($tw.wiki.getTiddler(CONFIG_TIDDLER).fields.text);\\r\\n            } catch (error) {\\r\\n                console.log('No tiddler config, using default');\\r\\n                config = configDefault;\\r\\n            }\\r\\n            return config;\\r\\n        }\\r\\n\\r\\n        function _writeConfigTiddler(newConfig) {\\r\\n            var config = newConfig || _config;\\r\\n            var Jconfig = JSON.stringify(config);\\r\\n            $tw.wiki.addTiddler(new $tw.Tiddler({ title: CONFIG_TIDDLER, type: \\\"application/json\\\", text: Jconfig }));\\r\\n            return true;\\r\\n        }\\r\\n\\r\\n        function _updateConfig(newConfig) {\\r\\n            // Extends existing config with the new one. Use empty object as base to avoid mutability\\r\\n            var config = $tw.utils.extend({}, _config, newConfig);\\r\\n            if (!config || !_isValidConfig(config)) {\\r\\n                Logger.log('Updating config to DB - ERROR', 'Tried to persist an invalid config');\\r\\n                return;\\r\\n            }\\r\\n            // After any update to the config persist the changes\\r\\n            return _persistConfig(config)\\r\\n                .then(_writeConfigTiddler)\\r\\n                .then(function () {\\r\\n                    $tw.rootWidget && $tw.rootWidget.dispatchEvent({ type: 'tm-tp-config-saved', param: true });\\r\\n                });\\r\\n        }\\r\\n\\r\\n        /*==== DATABASE METHODS === */\\r\\n        /**\\r\\n         * Saves the current configuration to the database\\r\\n         * \\r\\n         * @returns {Promise}\\r\\n         * - Fullfills to the document written\\r\\n         */\\r\\n        function _persistConfig(newConfig) {\\r\\n            var config = $tw.utils.extend({}, newConfig);\\r\\n            config._id = config._id || 'configuration';\\r\\n            return _configDB.put(config)\\r\\n                .then(\\r\\n                function (status) {\\r\\n                    Logger.log('Persist config to DB - OK', status);\\r\\n                    return _readConfigFromDB();\\r\\n                }\\r\\n                )\\r\\n                .catch(Logger.log.bind(Logger, 'Persist config to DB - ERROR'));\\r\\n        }\\r\\n\\r\\n        /**\\r\\n         * Reads the configuration from the _configDB\\r\\n         * This method should be called from init() or after the database is instantiated\\r\\n         *  \\r\\n         * @returns {Promise}\\r\\n         * - Fullfills with the configuration object\\r\\n         * - Rejects if no config exists or it is invalid \\r\\n         */\\r\\n        function _readConfigFromDB() {\\r\\n            return _configDB.get('configuration')\\r\\n            .then(function (config) {\\r\\n\\r\\n                if (_isValidConfig(config)) {\\r\\n                    return config;\\r\\n                }\\r\\n                throw new Error('Config was read, but it was invalid');\\r\\n            })\\r\\n            .catch(function (err) {\\r\\n\\r\\n                    Logger.log('Config read from DB - ERROR', err);\\r\\n                    throw err;\\r\\n                });   \\r\\n        }\\r\\n\\r\\n        /*==== HELPER METHODS === */\\r\\n        function _isValidConfig(config) {\\r\\n            var valid = false;\\r\\n            valid = !!(config && config.debug);\\r\\n            valid = !!(config && config.selectedDbId);\\r\\n            return valid;\\r\\n        }\\r\\n\\r\\n        /**\\r\\n         * Reads the configuration of certain database from the config object.\\r\\n         * Currently the _config holds also the databases configurations, but this may change on the future.\\r\\n         * \\r\\n         * If no configuration is found, returns a default config.\\r\\n         * \\r\\n         * @param {String} dbName name of the DB you want the config of\\r\\n         * @returns {Object} databaseConfig  \\r\\n         */\\r\\n        function _getDatabaseConfig(dbName) {\\r\\n            var configDefault = {\\r\\n                name: dbName,\\r\\n                remote: { name: null, username: null, ur: null }\\r\\n            }\\r\\n\\r\\n            _config.databases[dbName] = _config.databases[dbName] || configDefault;\\r\\n\\r\\n            return _config.databases[dbName];\\r\\n        }\\r\\n\\r\\n        /*==== PUBLIC METHODS === */\\r\\n        /**\\r\\n         * Updates the remote config of the current database.\\r\\n         * This is the only method that is allowed to modify the running config\\r\\n         * changes WILL NOT be persisted\\r\\n         * \\r\\n         * @param {Object} newConfig Options that extends the current configuration\\r\\n         \\r\\n        function updateRemoteConfig(newConfig){\\r\\n            currentDB.remote = $tw.utils.extend({}, currentDB.remote, newConfig); \\r\\n        }\\r\\n        */\\r\\n\\r\\n        /**\\r\\n         * Fetches the names of the databases which configuratons are saved\\r\\n         * \\r\\n         * @returns {Array} dbNames The names of all the databases configurations stored on the config\\r\\n         */\\r\\n        function getAllDBNames() {\\r\\n            var dbNames = [];\\r\\n            $tw.utils.each(_config.databases, function (db) {\\r\\n                dbNames.push(db.name);\\r\\n            });\\r\\n\\r\\n            return dbNames;\\r\\n        }\\r\\n\\r\\n        function isDebugActive() {\\r\\n            return _config.debug.active;\\r\\n        }\\r\\n\\r\\n        function isDebugVerbose() {\\r\\n            return _config.debug.verbose;\\r\\n        }\\r\\n\\r\\n\\r\\n\\r\\n        /**\\r\\n         * Initializes the configuration internals.\\r\\n         * - Creates the Pouch config db\\r\\n         * - Reads from the config database\\r\\n         * -- Load tiddler config if no config on db exists\\r\\n         * --- Load default config if no tiddler config exists\\r\\n         * - Updates the tiddler version of the config db\\r\\n         * - Persists config read from tiddler to DB\\r\\n         * \\r\\n         * @returns\\t{Promise} When fullfilled the configuration is ready to be used \\r\\n         */\\r\\n        function init() {\\r\\n            _configDB = $TPouch._configDb;\\r\\n            Logger.log('Initializing config module');\\r\\n            return _readConfigFromDB() // be aware of not breaking the promise chain!\\r\\n                .then(function (config) { // All ok reading from DB.\\r\\n                    Logger.debug(\\\"Config read from DB - OK\\\");\\r\\n                    _config = config;\\r\\n                    _writeConfigTiddler(); // Save current config to tiddler version \\r\\n                })\\r\\n                .catch( // Error reading from db, fallback to tiddler configuration \\r\\n                function (error) {\\r\\n                    Logger.debug(\\\"FallingBack to tiddler configuration\\\");\\r\\n                    _config = _readConfigTiddler();\\r\\n                    return _config; // return something to continue the chain!\\r\\n                }\\r\\n                ).then(\\r\\n                function () {\\r\\n                    currentDB = new SingleConfig(_getDatabaseConfig(_config.selectedDbId));\\r\\n                    return _updateConfig(); //Persisted at the end of the chain because some functions may update with default values\\r\\n                }\\r\\n                );\\r\\n        }\\r\\n\\r\\n        return init().then(\\r\\n            function () {\\r\\n                /*==== PUBLIC API === */\\r\\n                /* --- TiddlyPouch namespace creation and basic initialization---*/\\r\\n                $TPouch.Logger = LOGGER;\\r\\n                $TPouch.DbStore = require('$:/plugins/danielo515/tiddlypouch/dbstore/factory');\\r\\n                $TPouch.config = {\\r\\n                    getAllDBNames: getAllDBNames,\\r\\n                    readConfigTiddler: _readConfigTiddler,\\r\\n                    getDatabaseConfig: _getDatabaseConfig,\\r\\n                    update: _updateConfig,\\r\\n                    selectedDB: _config.selectedDbId,\\r\\n                    _configDB: _configDB,\\r\\n                    _config: _config,\\r\\n                    debug: {\\r\\n                        isActive: isDebugActive,\\r\\n                        isVerbose: isDebugVerbose\\r\\n                    },\\r\\n                    currentDB: currentDB\\r\\n                };\\r\\n                Ui.refreshUI(_config);\\r\\n                Logger.log('Configuration startup finished', _config);\\r\\n                callback();\\r\\n            });\\r\\n\\r\\n    };\\r\\n\\r\\n})();\",\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/startup/config.js\",\n            \"type\": \"application/javascript\",\n            \"module-type\": \"startup\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/startup/event-listeners.js\": {\n            \"text\": \"/*\\\\\\r\\ntitle: $:/plugins/danielo515/tiddlypouch/startup/event-listeners.js\\r\\ntype: application/javascript\\r\\nmodule-type: startup\\r\\n\\r\\nThis module creates the basic structure needed for the plugin.\\r\\nThis included the TiddlyPouch Object namespace and the local database\\r\\nThe existence of the database determines if the plugin will be active or not.\\r\\n\\r\\n@preserve\\r\\n\\r\\n\\\\*/\\r\\n\\r\\n(function () {\\r\\n\\r\\n    /*jslint node: true, browser: true */\\r\\n    /*global $tw: false */\\r\\n    \\\"use strict\\\";\\r\\n\\r\\n    // Export name and synchronous status\\r\\n    exports.name = \\\"TiddlyPouch-eventListeners\\\";\\r\\n    exports.after = [\\\"startup\\\"];\\r\\n    exports.platforms = [\\\"browser\\\"];\\r\\n    exports.synchronous = true;\\r\\n\\r\\n    exports.startup = function () {\\r\\n        var logger = new $TPouch.Logger(\\\"TiddlyPouch\\\");\\r\\n        var uiConnector = require(\\\"$:/plugins/danielo515/tiddlypouch/ui/config.js\\\");\\r\\n        var Utils = require('$:/plugins/danielo515/tiddlypouch/utils');\\r\\n\\r\\n        /*****************************************************************************\\r\\n        ########################### EVENT LISTENERS ##################################*/\\r\\n        $tw.rootWidget.addEventListener(\\\"tm-pouch-delete-db\\\", function (event) {\\r\\n            $tw.passwordPrompt.createPrompt({\\r\\n                serviceName: $tw.language.getString(\\\"TiddlyPouch/Delete-DB\\\", { variables: { database: $TPouch.config.currentDB.name } }),\\r\\n                noUserName: true,\\r\\n                submitText: \\\"Confirm\\\",\\r\\n                canCancel: true,\\r\\n                repeatPassword: false,\\r\\n                callback: function (data) {\\r\\n                    if (data && data.password === 'delete') {\\r\\n                        $TPouch.database.destroy().then(\\r\\n                            function () {\\r\\n                                logger.alert(\\\"Database \\\", $TPouch.config.currentDB.name, \\\" deleted!!!\\\")\\r\\n                            }\\r\\n                        );\\r\\n                    }\\r\\n                    return true; // Get rid of the password prompt\\r\\n                }\\r\\n            });\\r\\n        });\\r\\n\\r\\n        /**\\r\\n         * Just asks for the revisions array and saves it as a JSON tiddler.\\r\\n         */\\r\\n        $tw.rootWidget.addEventListener(\\\"tm-tp-load-revisions\\\",\\r\\n            function (event) {\\r\\n                $TPouch.database.getTiddlerRevisions(event.param)\\r\\n                    .then(function (revisionsList) {\\r\\n                        var title = \\\"$:/temp/revisions:\\\" + event.param\\r\\n                        Utils.saveAsJsonTiddler(title, revisionsList);\\r\\n                    });\\r\\n            });\\r\\n        /**\\r\\n         * Loads certain revision of a tiddler under the revision namespace\\r\\n         */\\r\\n        $tw.rootWidget.addEventListener(\\\"tm-tp-load-certain-revision\\\",\\r\\n            function (event) {\\r\\n                $TPouch.database.getTiddler(event.param, event.paramObject.revision)\\r\\n                    .then(function (tiddler) {\\r\\n                        tiddler.title = \\\"$:/temp/revision:\\\" + event.paramObject.revision.slice(0,6) + \\\":\\\" + event.param;\\r\\n                        $tw.wiki.addTiddler(tiddler);  \\r\\n                    });\\r\\n            });\\r\\n\\r\\n        /** ================ CONFIG RELATED ================ */\\r\\n        $tw.rootWidget.addEventListener(\\\"tm-tp-config-saved\\\", function () {\\r\\n            var reload = confirm('Configuration has been changed and saved. It is necessary to reload the window. Are you Ok with it?');\\r\\n            reload && location.reload();\\r\\n        });\\r\\n\\r\\n        $tw.rootWidget.addEventListener(\\\"tp-sync-state\\\", uiConnector.setSyncFlag);\\r\\n        $tw.rootWidget.addEventListener(\\\"tm-TP-config-selectedDb\\\", uiConnector.handlers.databaseHasBeenSelected);\\r\\n        $tw.rootWidget.addEventListener(\\\"tm-TP-config-updateDebug\\\", uiConnector.handlers.updateDebug);\\r\\n        $tw.rootWidget.addEventListener(\\\"tm-TP-config-updateSelectedDB\\\", uiConnector.handlers.updateDbConfig);\\r\\n\\r\\n    };\\r\\n\\r\\n})();\",\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/startup/event-listeners.js\",\n            \"type\": \"application/javascript\",\n            \"module-type\": \"startup\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/startup/pouch.js\": {\n            \"text\": \"/*\\\\\\r\\ntitle: $:/plugins/danielo515/tiddlypouch/startup/pouch.js\\r\\ntype: application/javascript\\r\\nmodule-type: startup\\r\\n\\r\\nThis module creates the basic structure needed for the plugin.\\r\\nThis included the TiddlyPouch Object namespace and the local database\\r\\nThe existence of the database determines if the plugin will be active or not.\\r\\n\\r\\n@preserve\\r\\n\\r\\n\\\\*/\\r\\n(function () {\\r\\n\\r\\n    /*jslint node: true, browser: true */\\r\\n    /*global $tw: false */\\r\\n    /*global emit: false*/\\r\\n    \\\"use strict\\\";\\r\\n\\r\\n    // Export name and synchronous status\\r\\n    exports.name = \\\"pouchdb\\\";\\r\\n    exports.before = [\\\"startup\\\"];\\r\\n    exports.platforms = [\\\"browser\\\"];\\r\\n    exports.synchronous = false;\\r\\n\\r\\n    exports.startup = function (callback) {\\r\\n        /* --- Declaration ZONE ---*/\\r\\n        //============================\\r\\n\\r\\n        var logger = new $TPouch.Logger(\\\"PouchStartup\\\");\\r\\n        var DbRouter = require(\\\"$:/plugins/danielo515/tiddlypouch/database/router.js\\\");\\r\\n        var Routes = require(\\\"$:/plugins/danielo515/tiddlypouch/database/routes\\\");\\r\\n\\r\\n        /* Here is where startup stuff really starts */\\r\\n        $TPouch._db = $TPouch._db || new PouchDB($TPouch.config.currentDB.name);\\r\\n        $TPouch.database = $TPouch.DbStore($TPouch.config.currentDB.name, 'tiddlers', $TPouch._db);\\r\\n        /** The plugins DbStore points to the same PouchDB as the tiddlers one, but they have different methods internally */\\r\\n        $TPouch.plugins = $TPouch.DbStore('__TP_plugins', 'plugins', $TPouch._db);\\r\\n        $TPouch.router = DbRouter.createRouter($TPouch.database);\\r\\n        /**Add the plugins route and database to the router.\\r\\n         *\\r\\n         */\\r\\n        $TPouch.router\\r\\n            .addRoute(Routes.plugins)\\r\\n            .addDestination('__TP_plugins', $TPouch.plugins);\\r\\n\\r\\n        logger.log(\\\"Client side dbs created\\\");\\r\\n        if ($TPouch.config.debug.isActive()) {\\r\\n            $TPouch.database._db.on('error', function (err) { logger.log(err); debugger; });\\r\\n        }\\r\\n        /** Create the required indexes (in parallel!) to operate the DBs  */\\r\\n        Promise.all([\\r\\n            //   $TPouch.plugins.createIndex('by_plugin_type', function (doc) { doc.fields && doc.fields['plugin-type'] && emit(doc.fields['plugin-type']) })\\r\\n            // , $TPouch.database.createIndex('by_type', function (doc) { doc.fields.type && emit(doc.fields.type) })\\r\\n            $TPouch.database.createIndex('skinny_tiddlers', function (doc) {\\r\\n                if(doc.fields['plugin-type']){ // skip plugins!\\r\\n                    return;\\r\\n                }\\r\\n                var fields = {};\\r\\n                for (var field in doc.fields) {\\r\\n                    if (['text'].indexOf(field) === -1) {\\r\\n                        fields[field] = doc.fields[field];\\r\\n                    }\\r\\n                }\\r\\n                fields.revision = doc._rev;\\r\\n                emit(doc._id, fields);\\r\\n            })\\r\\n            , $TPouch.database.createIndex('startup_tiddlers', function (doc){\\r\\n\\r\\n                doc.fields &&\\r\\n                (\\r\\n                     ( doc.fields.tags && doc.fields.tags.indexOf('$:/tags/Macro') !== -1)\\r\\n                     || doc.fields.type === 'application/javascript'\\r\\n                     || !!doc.fields['plugin-type']\\r\\n                )\\r\\n                && emit(doc.id)\\r\\n\\r\\n            })\\r\\n        ]).catch(function (reason) {\\r\\n\\r\\n            logger.log('Something went wrong during index creation', reason)\\r\\n        }).then(function () { /*Fetch and add the StoryList before core tries to save it*/\\r\\n\\r\\n            return $TPouch.database.getTiddler(\\\"$:/StoryList\\\")\\r\\n        }).then(function (tiddlerFields) {\\r\\n\\r\\n            $tw.wiki.addTiddler(tiddlerFields);\\r\\n            logger.debug(\\\"StoryList was already in database \\\", tiddlerFields);\\r\\n            return $TPouch.database.getTiddler(\\\"$:/DefaultTiddlers\\\")\\r\\n        }).then(function (tiddlerFields) {\\r\\n\\r\\n            $tw.wiki.addTiddler(tiddlerFields);\\r\\n            logger.log(\\\"Default tiddlers loaded from database \\\", tiddlerFields);\\r\\n        }).catch(function (err) {\\r\\n\\r\\n            logger.log(\\\"Error retrieving StoryList or DefaultTiddlers\\\");\\r\\n            logger.debug(err);\\r\\n        }).then(function () {\\r\\n\\r\\n            logger.log(\\\"Client side dbs initialized\\\");\\r\\n            callback();\\r\\n        });\\r\\n\\r\\n    };\\r\\n\\r\\n})();\",\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/startup/pouch.js\",\n            \"type\": \"application/javascript\",\n            \"module-type\": \"startup\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/startup/pouchdb-sycer.js\": {\n            \"text\": \"/*\\\\\\r\\ntitle: $:/plugins/danielo515/tiddlypouch/startup/pouchdb-sycer.js\\r\\ntype: application/javascript\\r\\nmodule-type: startup\\r\\n\\r\\n\\r\\n@preserve\\r\\n\\r\\n\\\\*/\\r\\n\\r\\n(function () {\\r\\n\\r\\n    /*jslint node: true, browser: true */\\r\\n    /*global $tw: false */\\r\\n    \\\"use strict\\\";\\r\\n\\r\\n    // Export name and synchronous status\\r\\n    exports.name = \\\"pouchdb-sycer\\\";\\r\\n    exports.after = [\\\"pouchdb\\\"];\\r\\n    exports.platforms = [\\\"browser\\\"];\\r\\n    exports.synchronous = true;\\r\\n\\r\\n    var SYNC_STATE = \\\"$:/state/tiddlypouch/sync/status\\\";\\r\\n    var SYNC_ERRORS = \\\"$:/state/tiddlypouch/sync/Log\\\"; // for now, log everything to the same place\\r\\n    var SYNC_LOG = \\\"$:/state/tiddlypouch/sync/Log\\\";\\r\\n    var CONFIG_PREFIX = \\\"$:/plugins/danielo515/tiddlypouch/config/\\\";\\r\\n\\r\\n    exports.startup = function () {\\r\\n        /* --- Declaration ZONE ---*/\\r\\n        /*============================*/\\r\\n        var logger = new $TPouch.Logger(\\\"PouchSync\\\");\\r\\n\\r\\n        function PouchLog(log, info, header) {\\r\\n            if ($TPouch.config.debug.isActive()) {\\r\\n                /*Appends info to the specified log tiddler*/\\r\\n                var oldinfo = $tw.wiki.getTiddlerText(log) + '\\\\n';\\r\\n                if (typeof info === 'object') {\\r\\n                    if (info.change && info.change.docs) {\\r\\n                        delete info.change.docs; //delete this horrible verbose thing\\r\\n                    }\\r\\n                    var newInfo = JSON.stringify(info, null, $tw.config.preferences.jsonSpaces);\\r\\n                }\\r\\n                else {\\r\\n                    var newInfo = info;\\r\\n                }\\r\\n                /* If provided we add the header to know what event called this logger\\r\\n                  if you try to add header in separate calls you may end with wrong order\\r\\n                  due to the asynchronous nature of the sync mechanism*/\\r\\n                newInfo = header ? header + newInfo : newInfo;\\r\\n                var logTiddler = { type: 'text/plain', text: oldinfo + newInfo, title: log };\\r\\n                $tw.wiki.addTiddler(new $tw.Tiddler(logTiddler));\\r\\n            }\\r\\n            logger.log(info);\\r\\n        }\\r\\n\\r\\n        function startSync(remoteDB) {\\r\\n            /*To-do: Should check if local db exists and if there is another sync going*/\\r\\n            /*First make sure we have the correct design document on the remote database.\\r\\n              This is mandatory for filtered replication. Filtered replication is necessary\\r\\n              to avoid replicating unnecesary documents like design documents.*/\\r\\n            return remoteDB.put(buildFilterView()).then(start).catch(function (err) {\\r\\n                if (err.status == 409) { // If we get a 409 the document exist on remote\\r\\n                    start(); // So start sync anyway\\r\\n                } else {\\r\\n                    PouchLog(SYNC_ERRORS, err, \\\"===SYNC Error starting===\\\");\\r\\n                    return err;\\r\\n                }\\r\\n            });\\r\\n            function start(info) { //Function that actually starts the sync\\r\\n                var sync = $TPouch.database._db.sync(remoteDB, {\\r\\n                    live: true,\\r\\n                    retry: true,\\r\\n                    filter: 'filtered_replication/only_tiddlers'\\r\\n                }).on('change', function (info) {\\r\\n                    PouchLog(SYNC_LOG, info, \\\"===SYNC Change===\\\");\\r\\n                }).on('paused', function (err) {\\r\\n                    $tw.wiki.setText(SYNC_STATE, 'text', undefined, 'paused')\\r\\n                    if (err)\\r\\n                        PouchLog(SYNC_LOG, err, \\\"===SYNC PAUSED===\\\")\\r\\n                    else\\r\\n                        PouchLog(SYNC_LOG, \\\"===SYNC PAUSED===\\\");\\r\\n                }).on('active', function () {\\r\\n                    $tw.wiki.setText(SYNC_STATE, 'text', undefined, 'syncing');\\r\\n                    PouchLog(SYNC_LOG, \\\"===SYNC ACTIVE===\\\");\\r\\n                    PouchLog(SYNC_LOG, \\\"replicate resumed\\\");\\r\\n                }).on('denied', function (info) {\\r\\n                    // a document failed to replicate\\r\\n                    PouchLog(SYNC_ERRORS, info, \\\"===SYNC Denied===\\\");\\r\\n                }).on('complete', function (info) {\\r\\n                    $tw.wiki.setText(SYNC_STATE, 'text', undefined, 'completed');\\r\\n                    PouchLog(SYNC_LOG, info, \\\"===SYNC Completed===\\\");\\r\\n                }).on('error', function (err) {\\r\\n                    $tw.wiki.setText(SYNC_STATE, 'text', undefined, 'error')\\r\\n                    PouchLog(SYNC_ERRORS, err, \\\"===SYNC Error===\\\");\\r\\n                });\\r\\n                /* For filtered replication to work, we need the filter view both on the remote DB and the local DB\\r\\n                * Please check https://pouchdb.com/2015/04/05/filtered-replication.html for more info\\r\\n                */\\r\\n                $TPouch.database._db\\r\\n                .put(buildFilterView())\\r\\n                .catch(function (err) {\\r\\n                    if (err.status !== 409) {\\r\\n                        PouchLog(SYNC_ERRORS, 'Filtered replication may not work, we were unable to store the required doc on the local DB', \\\"===SYNC Error starting===\\\");\\r\\n                    }\\r\\n                });\\r\\n                $TPouch.syncHandler = sync;\\r\\n            }\\r\\n        }\\r\\n\\r\\n        function newOnlineDB(authOptions) {\\r\\n            /* authOptions: {\\r\\n              username: 'mysecretusername',\\r\\n              password: 'mysecretpassword'\\r\\n            }*/\\r\\n            var Config = $TPouch.config;\\r\\n            var URL = Config.currentDB.getUrl();\\r\\n            var Databasename = Config.currentDB.getRemoteName();\\r\\n            /*If there is no URL set, then no sync*/\\r\\n            if (!URL) {\\r\\n                PouchLog(SYNC_LOG, \\\"Entering offline mode\\\");\\r\\n                $tw.rootWidget.dispatchEvent({ type: \\\"tp-sync-state\\\", param: \\\"offline\\\" });\\r\\n                return\\r\\n            }\\r\\n            $tw.rootWidget.dispatchEvent({ type: \\\"tp-sync-state\\\", param: \\\"online\\\" });\\r\\n\\r\\n            return new PouchDB(URL + Databasename, { auth: authOptions });\\r\\n        }\\r\\n\\r\\n        function buildFilterView() {\\r\\n            return {\\r\\n                \\\"_id\\\": \\\"_design/filtered_replication\\\",\\r\\n                \\\"filters\\\": {\\r\\n                    \\\"only_tiddlers\\\": function (doc) {\\r\\n                        return doc.hasOwnProperty('fields')\\r\\n                    }.toString()\\r\\n                }\\r\\n            }\\r\\n        };\\r\\n\\r\\n        /** Sync methos implantation */\\r\\n        $TPouch.startSync = startSync;\\r\\n        $TPouch.newOnlineDB = newOnlineDB;\\r\\n\\r\\n    };\\r\\n\\r\\n})();\",\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/startup/pouchdb-sycer.js\",\n            \"type\": \"application/javascript\",\n            \"module-type\": \"startup\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/startup/utils.js\": {\n            \"text\": \"/*\\\\\\r\\ntitle: $:/plugins/danielo515/tiddlypouch/startup/utils.js\\r\\ntype: application/javascript\\r\\nmodule-type: startup\\r\\n\\r\\nBasic Utils object is created int the pouch startup module\\r\\n\\r\\n@preserve\\r\\n\\r\\n\\\\*/\\r\\n\\r\\n/**@module */\\r\\n\\r\\n(function(){\\r\\n\\r\\n/*jslint node: true, browser: true */\\r\\n/*global $tw: false */\\r\\n\\\"use strict\\\";\\r\\n\\r\\n// Export name and synchronous status\\r\\nexports.name = \\\"pouchdb-utils\\\";\\r\\nexports.after = [\\\"pouchdb\\\"];\\r\\nexports.before = [\\\"pouchdb-sycer\\\"];\\r\\nexports.platforms = [\\\"browser\\\"];\\r\\nexports.synchronous = true;\\r\\n\\r\\nexports.startup = function() {\\r\\n  this.logger = new $TPouch.Logger(\\\"PouchDB\\\");\\r\\n  var self = this;\\r\\n  var db = $TPouch.database;\\r\\n\\r\\n  $TPouch.utils = {};\\r\\n  /** Removes the document with the provided title from the database*/\\r\\n  $TPouch.utils.remove = function(title){\\r\\n     db.get(title).then(\\r\\n       function(doc) {\\r\\n            return db.remove(doc);\\r\\n          }).then(function (result) {\\r\\n            self.logger.log(\\\"Document removed\\\",result);\\r\\n          }).catch(function (err) {\\r\\n            self.logger.log(err);\\r\\n          });\\r\\n   };\\r\\n   /** Replaces a document in the database with the provided one\\r\\n     without taking in account the revision.*/\\r\\n   $TPouch.utils.replace = function(newdoc){\\r\\n       db.get(newdoc._id).then(\\r\\n       function(doc) {\\r\\n            return db.remove(doc);\\r\\n          }).then(function () {\\r\\n            db.put(newdoc).then(function(doc){\\r\\n            self.logger.log(\\\"Document replaced\\\",doc)});\\r\\n          }).catch(function (err) {\\r\\n            self.logger.log(err);\\r\\n          });\\r\\n   }\\r\\n\\r\\n};\\r\\n\\r\\n})();\",\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/startup/utils.js\",\n            \"type\": \"application/javascript\",\n            \"module-type\": \"startup\"\n        },\n        \"$:/config/SyncFilter\": {\n            \"title\": \"$:/config/SyncFilter\",\n            \"comment\": \"Temprorary workaround until I implement this function in the syncer\",\n            \"text\": \"[is[tiddler]] -[[$:/HistoryList]] -[[$:/Import]] -[[$:/isEncrypted]] -[prefix[$:/status]] -[prefix[$:/state]] -[prefix[$:/temp]] -[prefix[$:/plugins/danielo515/tiddlypouch/]]\\r\\n\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/Buttons/download-basic\": {\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/Buttons/download-basic\",\n            \"text\": \"<$button class=\\\"tc-btn-big-green\\\">\\r\\n<$action-sendmessage $message=\\\"tm-download-file\\\" $param=\\\"$:/plugins/danielo515/tiddlypouch/save/basic\\\" filename=\\\"empty.html\\\"/>\\r\\nDownload Empty {{$:/core/images/save-button}}\\r\\n</$button>\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/ControlPanel/Database\": {\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/ControlPanel/Database\",\n            \"caption\": \"Database\",\n            \"tags\": \"$:/tags/TiddlyPouch/ControlPanel\",\n            \"text\": \"!!! Database Name {{$:/state/TiddlyPouch/info/databaseName||$:/plugins/danielo515/tiddlypouch/Buttons/info}}\\n\\n<$reveal type=\\\"match\\\" state=\\\"$:/state/TiddlyPouch/info/databaseName\\\" text=\\\"show\\\">\\r\\nThis is the name of your local database. Tiddlers are stored there.\\r\\nYou can have as many databases as you want. Changing this value will make your wiki to save/load\\r\\ntiddlers to/from that database. This requires a ''save and reload'' to take effect.\\r\\n</$reveal>\\n\\nName: {{$:/plugins/danielo515/tiddlypouch/ui/database-name}}\\r\\n@@color:#cc0000;\\r\\n,,//Without this parameter the plugin remains inactive //,,\\r\\n@@\\n\\n!!! Connection Info\\r\\nFill the fields below if you want to synchronize your local database with a remote\\r\\ncouch-like server.\\r\\nThis information will be saved as metadata of the selected local database.\\n\\n~CouchDB URL: {{$:/plugins/danielo515/tiddlypouch/ui/remote-url}}\\r\\n@@color:#c0c0c0;\\r\\n,,//EJ: ~https://someone.cloudant.com //,,\\r\\n@@\\n\\nRemote database name: {{$:/plugins/danielo515/tiddlypouch/ui/remote-name}}\\r\\n@@color:#c0c0c0;\\r\\n,,//Local database will be synced to this database. ''Must exist on server'' if you are not an admin user. //,,\\r\\n@@\\n\\n{{$:/plugins/danielo515/tiddlypouch/ui/save-database-config}}\\n\\n!!!Important information\\r\\nLocal databases are grouped by domain.\\r\\n''If you work'' with your wiki from a file then that particular file @@color:red; will not be able to\\r\\naccess@@ any of the databases created by any wiki accessed online.\\r\\nIf you want to sync databases between a wiki served by http and a local wiki you have to use\\r\\nsome couch backend or export and import the database.\\n\\n!!! Database delete\\r\\nThis will delete your current database.\\r\\nNote that if you are syncing to other devices this will only affects the local database, not the remote ones.\\r\\n@@color:#cc0000;\\r\\nThis action can not be undone!!\\r\\n@@\\r\\nPlease, reload your browser immediately after applying this.\\n\\n<$button message=\\\"tm-pouch-delete-db\\\">Delete database</$button>\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/ControlPanel/Debug\": {\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/ControlPanel/Debug\",\n            \"caption\": \"Debug\",\n            \"tags\": \"$:/tags/TiddlyPouch/ControlPanel\",\n            \"text\": \"\\r\\nActivate logging if you are experiencing problems while syncing or you are curious about it.\\n\\n\\\"\\\"\\\"\\r\\n<$checkbox tiddler=\\\"$:/plugins/danielo515/tiddlypouch/config/Debug/Active\\\" field=\\\"text\\\" checked=\\\"yes\\\" unchecked=\\\"no\\\" default=\\\"no\\\"> Debug mode</$checkbox>\\r\\n<$checkbox tiddler=\\\"$:/plugins/danielo515/tiddlypouch/config/Debug/Verbose\\\" field=\\\"text\\\" checked=\\\"yes\\\" unchecked=\\\"no\\\" default=\\\"no\\\"> Verbose mode</$checkbox>\\r\\n\\\"\\\"\\\"\\n\\n<$button message=\\\"tm-TP-config-updateDebug\\\">Save Config</$button>\\n\\n!!! Sync Log\\n\\n<$button>\\r\\n<$action-navigate $to=\\\"$:/state/tiddlypouch/sync/Log\\\"/>\\r\\nOpen Log\\r\\n</$button>\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/ControlPanel/Download\": {\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/ControlPanel/Download\",\n            \"caption\": \"Download\",\n            \"tags\": \"$:/tags/TiddlyPouch/ControlPanel\",\n            \"text\": \"Here you have different methods of download this wiki.\\n\\n!!Save config\\r\\nThis downloads this wiki without any tiddler created by the user. ''Useful if'':\\n\\n* You have changed any setting and you want to persist those changes.\\r\\n* You want to sync this wiki from the server in another computer/browser.\\r\\n* You have installed another plugin and need to restart.\\r\\n* You want to start again without any tiddler but keeping your current configuration\\n\\n{{$:/plugins/danielo515/tiddlypouch/Buttons/download-empty}}\\n\\n!!Pack database\\r\\nThis option packs the database currently in use into a system tiddler and then it \\r\\ndownloads the wiki with it. ''Useful'' if you want to use this wiki in a different computer \\r\\nor browser.\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/ui/remote-user\": {\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/ui/remote-user\",\n            \"text\": \"<$edit-text tag=\\\"input\\\" index=\\\"remote.user\\\" tiddler=\\\"$:/plugins/danielo515/tiddlypouch/config/selected_database\\\"  default=\\\"\\\"/>\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/ui/remote-name\": {\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/ui/remote-name\",\n            \"text\": \"<$edit-text tag=\\\"input\\\" index=\\\"remote.name\\\" tiddler=\\\"$:/plugins/danielo515/tiddlypouch/config/selected_database\\\" default=\\\"\\\"/>\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/ui/remote-url\": {\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/ui/remote-url\",\n            \"text\": \"<$edit-text tag=\\\"input\\\" index=\\\"remote.url\\\" tiddler=\\\"$:/plugins/danielo515/tiddlypouch/config/selected_database\\\"  default=\\\"\\\"/>\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/ui/save-database-config\": {\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/ui/save-database-config\",\n            \"text\": \"<$button message=\\\"tm-TP-config-updateSelectedDB\\\">Save Config</$button>\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/ControlPanel\": {\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/ControlPanel\",\n            \"caption\": \"~TiddlyPouch\",\n            \"tags\": \"$:/tags/ControlPanel\",\n            \"text\": \"<div class=\\\"tc-tiddlypouch-control-panel\\\">\\r\\n<<tabs \\\"[all[shadows]tag[$:/tags/TiddlyPouch/ControlPanel]]\\\" \\\"$:/plugins/danielo515/tiddlypouch/ControlPanel/Download\\\" \\\"$:/state/TiddlyPouch/tabs\\\">>\\r\\n</div>\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/Buttons/download-empty\": {\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/Buttons/download-empty\",\n            \"text\": \"<$button class=\\\"tc-btn-big-green\\\">\\r\\n<$action-sendmessage $message=\\\"tm-download-file\\\" $param=\\\"$:/plugins/danielo515/tiddlypouch/save/empty\\\" filename=\\\"empty.html\\\"/>\\r\\nSave config {{$:/core/images/save-button}}\\r\\n</$button>\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/save/empty\": {\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/save/empty\",\n            \"text\": \"\\\\define saveTiddlerFilter()\\r\\n[is[system]] -[prefix[$:/state/]] -[[$:/boot/boot.css]] -[type[application/javascript]library[yes]] -[[$:/boot/boot.js]] -[[$:/boot/bootprefix.js]] +[sort[title]]\\r\\n\\\\end\\r\\n\\\\define savingEmpty()\\r\\nyes\\r\\n\\\\end\\r\\n{{$:/core/templates/tiddlywiki5.html}}\\n\\n\\r\\n\"\n        },\n        \"GettingStarted\": {\n            \"title\": \"GettingStarted\",\n            \"text\": \"\\\\define lingo-base() $:/language/ControlPanel/Basics/\\r\\nWelcome to ~NoteSelf and the ~TiddlyWiki community\\n\\nYou can start using your notebook right NOW. Go ahead and collect ideas, make lists, take notes, start a diary...\\r\\nYou can have as many notebooks as you want.\\r\\nJust change the `Notebook Name` and hit the save config button. New notes will be saved to that notebook.\\n\\nIn case you want automatic synchronization fill the fields of the synchronization section below\\n\\n!! Setup this Notebook\\n\\n<div class=\\\"tc-control-panel\\\">\\n\\n|<<tiddlypouch-tab \\\"Notebook Name\\\" \\\"Database\\\" >> |{{$:/plugins/danielo515/tiddlypouch/ui/database-name}} |\\r\\n|! Sync configuration|<|\\r\\n|<<tiddlypouch-tab \\\"CouchDB URL\\\" \\\"Database\\\" >> |{{$:/plugins/danielo515/tiddlypouch/ui/remote-url}} |\\r\\n|<<tiddlypouch-tab \\\"Remote database name\\\" \\\"Database\\\" >> |{{$:/plugins/danielo515/tiddlypouch/ui/remote-name}} |\\r\\n| {{$:/plugins/danielo515/tiddlypouch/ui/save-database-config}} |<|\\r\\n|<$link to=\\\"$:/SiteTitle\\\">Page title</$link> |<$edit-text tiddler=\\\"$:/SiteTitle\\\" default=\\\"\\\" tag=\\\"input\\\"/> |\\r\\n|<$link to=\\\"$:/DefaultTiddlers\\\"><<lingo DefaultTiddlers/Prompt>></$link> |<<lingo DefaultTiddlers/TopHint>><br> <$edit tag=\\\"textarea\\\" tiddler=\\\"$:/DefaultTiddlers\\\"/><br>//<<lingo DefaultTiddlers/BottomHint>>// |\\r\\n</div>\\n\\nSee the [[control panel|$:/ControlPanel]] for more options.\\r\\n\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/Buttons/info\": {\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/Buttons/info\",\n            \"comment\": \"this tiddler should be used as a transclude template\",\n            \"text\": \"<$reveal type=\\\"nomatch\\\" state={{!!title}} text=\\\"show\\\">\\r\\n<$button set={{!!title}} setTo=\\\"show\\\" class=\\\"tc-btn-invisible\\\"><span style=\\\"top:-9px; position: relative\\\">{{$:/core/images/help}}</span></$button>\\r\\n</$reveal><$reveal type=\\\"match\\\" state={{!!title}} text=\\\"show\\\">\\r\\n<$button set={{!!title}} class=\\\"tc-btn-invisible\\\" setTo=\\\"hide\\\"><span style=\\\"top:-9px; position: relative\\\">{{$:/core/images/help}}</span></$button>\\r\\n</$reveal>\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/Installation\": {\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/Installation\",\n            \"created\": \"20140901120057909\",\n            \"modified\": \"20160730120057909\",\n            \"type\": \"text/vnd.tiddlywiki\",\n            \"text\": \"# Open your wiki in a browser\\r\\n# Drag this link into your wiki\\r\\n#> [[$:/plugins/danielo515/tiddlypouch]]\\r\\n# Save your wiki\\r\\n\"\n        },\n        \"$:/language/TiddlyPouch/Delete-DB\": {\n            \"title\": \"$:/language/TiddlyPouch/Delete-DB\",\n            \"text\": \"You are going to delete database named <<database>>. Please type 'delete' and click confirm.\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/language/revisions/Hint\": {\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/language/revisions/Hint\",\n            \"text\": \"Show current tiddler revisions\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/language/revisions/Caption\": {\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/language/revisions/Caption\",\n            \"text\": \"Show revisions\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/save/basic\": {\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/save/basic\",\n            \"text\": \"\\\\define saveTiddlerFilter()\\r\\n[[$:/core]] [prefix[$:/plugins/danielo515/tiddlypouch/config/]] [[$:/isEncrypted]] [[$:/plugins/danielo515/tiddlypouch]] [[$:/themes/tiddlywiki/snowwhite]] [[$:/themes/tiddlywiki/vanilla]] -[[$:/boot/boot.css]] -[type[application/javascript]library[yes]] -[[$:/boot/boot.js]] -[[$:/boot/bootprefix.js]] +[sort[title]]\\r\\n\\\\end\\r\\n\\\\define savingEmpty()\\r\\nyes\\r\\n\\\\end\\r\\n{{$:/core/templates/tiddlywiki5.html}}\"\n        },\n        \"$:/SiteTitle\": {\n            \"title\": \"$:/SiteTitle\",\n            \"text\": \"My Notebook\"\n        },\n        \"$:/state/tiddlypouch/sync/errors\": {\n            \"title\": \"$:/state/tiddlypouch/sync/errors\",\n            \"text\": \"\\r\\n\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/ui/sync-flag\": {\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/ui/sync-flag\",\n            \"text\": \"<$reveal type=\\\"match\\\" state=\\\"$:/state/tiddlypouch/sync/status\\\" text=\\\"offline\\\">\\r\\n<$button message=\\\"tm-login\\\" >Offline</$button>\\r\\n</$reveal>\\n\\n<$reveal type=\\\"nomatch\\\" state=\\\"$:/state/tiddlypouch/sync/status\\\" text=\\\"offline\\\">\\r\\n<$button class=\\\"tc-btn-invisible\\\">\\r\\n<$reveal type=\\\"match\\\" state=\\\"$:/state/tiddlypouch/sync/status\\\" text=\\\"error\\\">{{$:/plugins/danielo515/tiddlypouch/images/cloud-error}}</$reveal>\\r\\n<$reveal type=\\\"match\\\" state=\\\"$:/state/tiddlypouch/sync/status\\\" text=\\\"paused\\\">{{$:/plugins/danielo515/tiddlypouch/images/cloud-ok}}</$reveal>\\r\\n<$reveal type=\\\"match\\\" state=\\\"$:/state/tiddlypouch/sync/status\\\" text=\\\"syncing\\\">{{$:/plugins/danielo515/tiddlypouch/images/cloud-spinning}}</$reveal>\\r\\n</$button>\\r\\n</$reveal>\"\n        },\n        \"$:/state/tiddlypouch/sync/Log\": {\n            \"title\": \"$:/state/tiddlypouch/sync/Log\",\n            \"text\": \"\\r\\n\"\n        },\n        \"$:/state/tiddlypouch/sync/status\": {\n            \"title\": \"$:/state/tiddlypouch/sync/status\",\n            \"text\": \"offline\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/Stylesheet/ControlPanel\": {\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/Stylesheet/ControlPanel\",\n            \"tags\": \"$:/tags/Stylesheet\",\n            \"text\": \".tc-tiddlypouch-control-panel input {\\r\\n    width: 100%;\\r\\n}\\n\\n.tc-tiddlypouch-control-panel input[type=\\\"checkbox\\\"], .tc-tiddlypouch-control-panel-checkbox {\\r\\n    width: auto;\\r\\n}\\n\\n.tc-tiddlypouch-control-panel .tc-type-selector input, .tc-control-panel table .tc-type-selector input {\\r\\n    width: auto;\\r\\n}\\n\\n.tc-plugin-reload-warning svg {\\r\\n    height: 1em;\\r\\n}\"\n        },\n        \"$:/core/ui/PageTemplate/pluginreloadwarning\": {\n            \"title\": \"$:/core/ui/PageTemplate/pluginreloadwarning\",\n            \"tags\": \"$:/tags/PageTemplate\",\n            \"text\": \"\\\\define lingo-base() $:/language/\\n\\n<$list filter=\\\"[has[plugin-type]haschanged[]!plugin-type[import]limit[1]]\\\">\\n\\n<$reveal type=\\\"nomatch\\\" state=\\\"$:/temp/HidePluginWarning\\\" text=\\\"yes\\\">\\n\\n<div class=\\\"tc-plugin-reload-warning\\\">\\n\\n<$set name=\\\"tv-config-toolbar-class\\\" value=\\\"\\\">\\n\\nYou have just installed a plugin. Please wait until changes has been saved (<span class=\\\"tc-dirty-indicator\\\">{{$:/core/images/done-button}}</span>) and reload the window <$button set=\\\"$:/temp/HidePluginWarning\\\" setTo=\\\"yes\\\" class=\\\"tc-btn-invisible\\\">{{$:/core/images/close-button}}</$button>\\n\\n</$set>\\n\\n</div>\\n\\n</$reveal>\\n\\n</$list>\"\n        },\n        \"$:/core/ui/TiddlerInfo\": {\n            \"title\": \"$:/core/ui/TiddlerInfo\",\n            \"text\": \"<$macrocall $name=\\\"tabs-state\\\" tabsList=\\\"[all[shadows+tiddlers]tag[$:/tags/TiddlerInfo]!has[draft.of]]\\\" state=<<tiddlerInfoTabState>> default={{$:/config/TiddlerInfo/Default}}/>\"\n        },\n        \"$:/core/ui/ViewTemplate\": {\n            \"title\": \"$:/core/ui/ViewTemplate\",\n            \"text\": \"\\\\define InfoTabState()\\r\\n$:/state/infotab/$(currentTiddler)$\\r\\n\\\\end\\r\\n\\\\define frame-classes()\\r\\ntc-tiddler-frame tc-tiddler-view-frame $(missingTiddlerClass)$ $(shadowTiddlerClass)$ $(systemTiddlerClass)$ $(tiddlerTagClasses)$\\r\\n\\\\end\\r\\n\\\\define folded-state()\\r\\n$:/state/folded/$(currentTiddler)$\\r\\n\\\\end\\r\\n<$set name=\\\"storyTiddler\\\" value=<<currentTiddler>>><$set name=\\\"tiddlerInfoState\\\" value=<<qualify \\\"$:/state/popup/tiddler-info\\\">> ><$set name=\\\"tiddlerInfoTabState\\\" value=<<InfoTabState>> ><$tiddler tiddler=<<currentTiddler>>><div class=<<frame-classes>>><$list filter=\\\"[all[shadows+tiddlers]tag[$:/tags/ViewTemplate]!has[draft.of]]\\\" variable=\\\"listItem\\\"><$transclude tiddler=<<listItem>>/></$list>\\r\\n</div>\\r\\n</$tiddler></$set></$set></$set>\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/buttons/revisions\": {\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/buttons/revisions\",\n            \"caption\": \"{{$:/plugins/danielo515/tiddlypouch/language/revisions/Caption}}\",\n            \"description\": \"{{$:/plugins/danielo515/tiddlypouch/language/revisions/Hint}}\",\n            \"tags\": \"$:/tags/ViewToolbar\",\n            \"text\": \"<$button popup=<<tiddlerInfoState>> tooltip={{$:/plugins/danielo515/tiddlypouch/language/revisions/Hint}} aria-label={{$:/plugins/danielo515/tiddlypouch/language/revisions/Caption}} class=<<tv-config-toolbar-class>>>\\r\\n<$action-setfield $tiddler=<<tiddlerInfoTabState>> text=\\\"$:/plugins/danielo515/tiddlypouch/ui/revisions\\\"/>\\r\\n<$action-sendmessage $message=\\\"tm-tp-load-revisions\\\" $param=<<currentTiddler>>/>\\r\\n<$list filter=\\\"[<tv-config-toolbar-icons>prefix[yes]]\\\">\\r\\n{{$:/plugins/danielo515/tiddlypouch/images/revisions}}\\r\\n</$list>\\r\\n<$list filter=\\\"[<tv-config-toolbar-text>prefix[yes]]\\\">\\r\\n<span class=\\\"tc-btn-text\\\"><$text text={{$:/plugins/danielo515/tiddlypouch/language/revisions/Caption}}/></span>\\r\\n</$list>\\r\\n</$button>\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/ui/revisions/review-tabs\": {\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/ui/revisions/review-tabs\",\n            \"list-after\": \"$:/core/ui/ViewTemplate/title\",\n            \"tags\": \"$:/tags/ViewTemplate\",\n            \"text\": \"<$list filter=\\\"[prefix[$:/temp/revision:]suffix<currentTiddler>!field:title<currentTiddler>limit[1]]\\\" variable=\\\"ui-null\\\">\\r\\n<$macrocall $name=\\\"revision-tabs\\\"\\r\\ntabsList=\\\"[prefix[$:/temp/revision:]suffix<currentTiddler>]\\\"\\r\\ndefault=<<currentTiddler>>\\r\\nstate=\\\"$:/state/review/tabs\\\"\\r\\nclass=\\\"tc-review-tabs\\\"\\r\\ntemplate=\\\"$:/plugins/danielo515/tiddlypouch/ui/revisions/transclude-template\\\" />\\r\\n</$list>\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/ui/revisions/styles\": {\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/ui/revisions/styles\",\n            \"tags\": \"$:/tags/Stylesheet\",\n            \"text\": \"\\\\rules only filteredtranscludeinline transcludeinline macrodef macrocallinline macrocallblock\\n\\n.tc-review-tabs {  \\r\\n      line-height: 22px; \\r\\n}\\n\\n/* avoid nested view template be moved */\\r\\n.tc-review-tabs .tc-tiddler-frame {\\r\\n    padding-top:0px;\\r\\n    padding-bottom: 0px;\\r\\n    margin-bottom: 0px;\\r\\n    box-shadow: none;\\r\\n    border: none;\\r\\n}\\n\\n.tc-review-tabs .tc-titlebar {\\r\\n    display: none;\\r\\n}\\n\\n/* This block adjusts the margins inside the review tabs\\r\\n   in the different breakpoints\\r\\n*/\\n\\n@media (max-width: {{$:/themes/tiddlywiki/vanilla/metrics/sidebarbreakpoint}}) {\\r\\n    .tc-tab-set.tc-review-tabs{\\r\\n        margin-left: -14px;\\r\\n    }\\r\\n}\\n\\n@media (min-width: {{$:/themes/tiddlywiki/vanilla/metrics/sidebarbreakpoint}}) {\\n\\n    .tc-tab-set.tc-review-tabs{\\r\\n        margin-left: -43px;\\r\\n    }\\n\\n}\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/macros/revision-tabs\": {\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/macros/revision-tabs\",\n            \"tags\": \"$:/tags/Macro\",\n            \"text\": \"\\\\define revision-tabs(tabsList,default,state:\\\"$:/state/tab\\\",class,template)\\r\\n<div class=\\\"tc-tab-set $class$\\\">\\r\\n<div class=\\\"tc-tab-buttons $class$\\\">\\r\\n<$button set=<<qualify \\\"$state$\\\">> setTo=<<currentTiddler>> default=\\\"$default$\\\" selectedClass=\\\"tc-tab-selected\\\" tooltip={{!!tooltip}}>\\r\\n<$action-setfield $tiddler=<<folded-state>> text=\\\"show\\\"/>\\r\\n<$set name=\\\"tv-wikilinks\\\" value=\\\"no\\\">\\r\\n<!-- TODO: localization -->\\r\\nCurrent\\r\\n</$set></$button><$list filter=\\\"$tabsList$ -[<currentTiddler>]\\\" variable=\\\"currentTab\\\"><$set name=\\\"save-currentTiddler\\\" value=<<currentTiddler>>><$tiddler tiddler=<<currentTab>>><$button set=<<qualify \\\"$state$\\\">> setTo=<<currentTab>> default=\\\"$default$\\\" selectedClass=\\\"tc-tab-selected\\\" tooltip={{!!tooltip}}>\\r\\n<$tiddler tiddler=<<save-currentTiddler>>>\\r\\n<$action-setfield $tiddler=<<folded-state>> text=\\\"hide\\\"/>\\r\\n<$set name=\\\"tv-wikilinks\\\" value=\\\"no\\\">\\r\\n<$list filter=\\\"[<currentTab>removeprefix[$:/temp/revision:]removesuffix<currentTiddler>]\\\" variable=\\\"currentTab\\\">\\r\\n<$macrocall $name=\\\"currentTab\\\" $type=\\\"text/plain\\\" $output=\\\"text/plain\\\"/>\\r\\n</$list>\\r\\n</$set></$tiddler></$button></$tiddler></$set></$list>\\r\\n</div>\\r\\n<div class=\\\"tc-tab-divider $class$\\\"/>\\r\\n<div class=\\\"tc-tab-content $class$\\\">\\r\\n<$list filter=\\\"$tabsList$\\\" variable=\\\"currentTab\\\">\\n\\n<$reveal type=\\\"match\\\" state=<<qualify \\\"$state$\\\">> text=<<currentTab>> default=\\\"$default$\\\">\\n\\n<$transclude tiddler=\\\"$template$\\\" mode=\\\"block\\\">\\n\\n<$transclude tiddler=<<currentTab>> mode=\\\"block\\\"/>\\n\\n</$transclude>\\n\\n</$reveal>\\n\\n</$list>\\r\\n</div>\\r\\n</div>\\r\\n\\\\end\\r\\n\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/ui/revisions/transclude-template\": {\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/ui/revisions/transclude-template\",\n            \"text\": \"<!-- This template should be used with the tabs macro  -->\\r\\n<$list filter=\\\"[is[current]!field:title<currentTab>]\\\">\\r\\n<$tiddler tiddler=<<currentTab>>>\\r\\n<$transclude tiddler=\\\"$:/core/ui/ViewTemplate\\\"/>\\r\\n</$tiddler>\\r\\n</$list>\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/ui/revisions\": {\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/ui/revisions\",\n            \"caption\": \"Revisions\",\n            \"tags\": \"$:/tags/TiddlerInfo\",\n            \"text\": \"<$button message=\\\"tm-tp-load-revisions\\\" param={{!!title}}>\\r\\n    Reload revisions\\r\\n</$button>\\r\\n<table>\\r\\n<$list filter=\\\"[{!!title}addprefix[$:/temp/revisions:]]\\\" variable=\\\"rev-store\\\">\\r\\n    <$list filter=\\\"[<rev-store>indexes[]nsort[]]\\\" variable=\\\"index\\\">\\r\\n        <$list filter=\\\"[<rev-store>getindex<index>]\\\" variable=\\\"revision\\\">\\r\\n            <tr><td><$button class=\\\"tc-btn-invisible tc-tiddlylink\\\">\\r\\n                <$action-sendmessage $message=\\\"tm-tp-load-certain-revision\\\" $param={{!!title}} revision=<<revision>>/>\\r\\n                <$text text=<<revision>>/>\\r\\n            </$button>\\r\\n            </td></tr>\\r\\n        </$list>\\r\\n    </$list>\\r\\n</$list>\\r\\n</table>\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/macros/tabs-state\": {\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/macros/tabs-state\",\n            \"tags\": \"$:/tags/Macro\",\n            \"text\": \"\\\\define tabs-state(tabsList,default,state:\\\"$:/state/tab\\\",class,template)\\r\\n<div class=\\\"tc-tab-set $class$\\\">\\r\\n<div class=\\\"tc-tab-buttons $class$\\\">\\r\\n<$list filter=\\\"$tabsList$\\\" variable=\\\"currentTab\\\">\\r\\n<$button set=<<tiddlerInfoTabState>> setTo=<<currentTab>> default=\\\"$default$\\\" selectedClass=\\\"tc-tab-selected\\\">\\r\\n<$transclude tiddler=<<currentTab>> field=\\\"caption\\\">\\r\\n<$macrocall $name=\\\"currentTab\\\" $type=\\\"text/plain\\\" $output=\\\"text/plain\\\"/>\\r\\n</$transclude>\\r\\n</$button>\\r\\n</$list>\\r\\n</div><div class=\\\"tc-tab-divider $class$\\\"/><div class=\\\"tc-tab-content $class$\\\">\\r\\n<$list filter=\\\"$tabsList$\\\" variable=\\\"currentTab\\\">\\n\\n<$reveal type=\\\"match\\\" state=<<tiddlerInfoTabState>> text=<<currentTab>> default=\\\"$default$\\\">\\n\\n<$transclude tiddler=\\\"$template$\\\" mode=\\\"block\\\">\\n\\n<$transclude tiddler=<<currentTab>> mode=\\\"block\\\"/>\\n\\n</$transclude>\\n\\n</$reveal>\\n\\n</$list>\\r\\n</div>\\r\\n</div>\\r\\n\\\\end\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/macros/navigate-to-controlPanel-tab\": {\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/macros/navigate-to-controlPanel-tab\",\n            \"tags\": \"$:/tags/Macro\",\n            \"text\": \"\\\\define control-panel-tab(caption target)\\r\\n<$button class=\\\"tc-btn-invisible tc-tiddlylink\\\">\\r\\n    <$action-setfield $tiddler=\\\"$:/state/tab-1749438307\\\" text=\\\"$target$\\\" />\\r\\n    <$action-navigate $to=\\\"$:/ControlPanel\\\" />\\r\\n    $caption$\\r\\n</$button>\\r\\n\\\\end\\n\\n\\\\define tiddlypouch-tab(caption target)\\r\\n<$button class=\\\"tc-btn-invisible tc-tiddlylink\\\">\\r\\n    <$action-setfield $tiddler=\\\"$:/state/tab-1749438307\\\" text=\\\"$:/plugins/danielo515/tiddlypouch/ControlPanel\\\" />\\r\\n    <$action-setfield $tiddler=\\\"$:/state/TiddlyPouch/tabs--1566775042\\\" text=\\\"$:/plugins/danielo515/tiddlypouch/ControlPanel/$target$\\\"/>\\r\\n    <$action-navigate $to=\\\"$:/ControlPanel\\\" />\\r\\n    <$text text=\\\"$caption$\\\"/>\\r\\n</$button>\\r\\n\\\\end\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/ui/database-name\": {\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/ui/database-name\",\n            \"text\": \"<div class=\\\"tc-type-selector\\\">\\r\\n<$edit-text tiddler=\\\"$:/plugins/danielo515/tiddlypouch/config/selected_database\\\" index=\\\"name\\\" tag=\\\"input\\\" default=\\\"\\\" focusPopup=<<qualify \\\"$:/state/TyddlyPouch/database-popup\\\">> class=\\\"tc-popup-handle\\\"/>\\r\\n<$button popup=<<qualify \\\"$:/state/TyddlyPouch/database-popup\\\">> class=\\\"tc-btn-invisible tc-btn-dropdown\\\" tooltip=\\\"list existing databases\\\" aria-label=\\\"list existing databases\\\">{{$:/core/images/down-arrow}}</$button>\\n\\n\\r\\n<div class=\\\"tc-block-dropdown-wrapper\\\">\\r\\n<$reveal state=<<qualify \\\"$:/state/TyddlyPouch/database-popup\\\">> type=\\\"nomatch\\\" text=\\\"\\\" default=\\\"\\\">\\r\\n<div class=\\\"tc-block-dropdown tc-edit-type-dropdown\\\">\\r\\n<$list filter=\\\"[list[$:/plugins/danielo515/tiddlypouch/config/database_names]]\\\">\\r\\n<div class=\\\"tc-dropdown-item\\\">\\r\\n<$button class=\\\"tc-btn-invisible\\\" message=\\\"tm-TP-config-selectedDb\\\" param={{!!title}}>\\r\\n<$text text={{!!title}}/>\\r\\n</$button>\\r\\n</div>\\r\\n</$list>\\r\\n</div>\\r\\n</$reveal>\\r\\n</div>\\r\\n</div>\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/ui/config.js\": {\n            \"text\": \"/*\\\\\\r\\ntype: application/javascript\\r\\ntitle: $:/plugins/danielo515/tiddlypouch/ui/config.js\\r\\nmodule-type: library\\r\\n\\r\\nLinks the user interface with the configuration methods \\r\\n\\r\\n@preserve\\r\\n\\r\\n\\\\*/\\r\\n\\r\\n/** @module */\\r\\n\\r\\n(function(){\\r\\n\\r\\n/*jslint node: true, browser: true */\\r\\n/*global $tw: false */\\r\\n\\\"use strict\\\";\\r\\n\\r\\nvar DEBUG_CONFIG = \\\"$:/plugins/danielo515/tiddlypouch/config/Debug\\\";\\r\\nvar DEBUG_ACTIVE = DEBUG_CONFIG + \\\"/Active\\\";\\r\\nvar DEBUG_VERBOSE = DEBUG_CONFIG + \\\"/Verbose\\\";\\r\\nvar DATABASE_NAMES = \\\"$:/plugins/danielo515/tiddlypouch/config/database_names\\\";\\r\\nvar SELECTED_DATABASE = \\\"$:/plugins/danielo515/tiddlypouch/config/selected_database\\\";\\r\\nvar SYNC_ICON = \\\"$:/plugins/danielo515/tiddlypouch/ui/sync-flag\\\";\\r\\n\\r\\nvar Utils = require('$:/plugins/danielo515/tiddlypouch/utils');\\r\\n\\r\\nexports.refreshUI = function refreshUI(config) {\\r\\n    updateDebugUI(config);\\r\\n    refreshSelectedDBUI(config.databases[config.selectedDbId]);\\r\\n    setSyncFlag();\\r\\n    refreshDatabaseNamesUI();\\r\\n    setLoginMessage();\\r\\n    setSiteSubtitleToDatabaseName();\\r\\n};\\r\\n\\r\\nexports.handlers = {};\\r\\n\\r\\nfunction setSyncFlag(mode) {\\r\\n    var sincStatusFlag = $tw.wiki.getTiddler(SYNC_ICON);\\r\\n    /* Because I'm unsure about how to decide if we are in offline mode\\r\\n        i can take both, a message param or just a plain function execution.\\r\\n        take a look at startup-syncer for the emit of the events\\r\\n    */\\r\\n    if (mode === \\\"offline\\\" || !$TPouch.config.currentDB.getUrl()) {\\r\\n        /* We don't want sync status icon on sidebar*/\\r\\n        return $tw.wiki.addTiddler(new $tw.Tiddler(sincStatusFlag,{tags: []})); //Remove tags\\r\\n    }\\r\\n    /*Otherwise, add to sidebar with the tag (it could be removed) */\\r\\n    $tw.wiki.addTiddler(new $tw.Tiddler(sincStatusFlag,{tags: ['$:/tags/PageControls']}));\\r\\n}\\r\\n\\r\\nexports.setSyncFlag = setSyncFlag;\\r\\n\\r\\nfunction setSiteSubtitleToDatabaseName() {\\r\\n    var text = \\\"<<tiddlypouch-tab \\\" + $TPouch.config.currentDB.name + \\\" Database >>\\\";\\r\\n    $tw.wiki.addTiddler({ title: \\\"$:/SiteSubtitle\\\", text: text });\\r\\n}\\r\\n\\r\\n/**\\r\\n * Sets the message \\\"Login to <xxx>\\\" that is showed by tiddlywiki\\r\\n * to remote URL of the current database.  \\r\\n */\\r\\nfunction setLoginMessage() {\\r\\n    var loginDestination = $TPouch.config.currentDB.getUrl();\\r\\n    var databaseName = $TPouch.config.currentDB.getRemoteName();\\r\\n    var message = \\\"Login to remote database <b>\\\" + databaseName + \\\"</b> at: \\\" + loginDestination;\\r\\n    $tw.wiki.addTiddler({\\r\\n        title: \\\"$:/language/LoginToTiddlySpace\\\" ,\\r\\n        text: message\\r\\n    });\\r\\n\\r\\n}\\r\\n\\r\\nfunction refreshDatabaseNamesUI() {\\r\\n    var namesList = $TPouch.config.getAllDBNames();\\r\\n    $tw.wiki.addTiddler({title: DATABASE_NAMES , list: namesList, text: \\\"{{!!list}}\\\" })\\r\\n}\\r\\n\\r\\nexports.handlers.updateDebug = function(event){\\r\\n    var Active = $tw.wiki.getTiddlerText(DEBUG_ACTIVE) === 'yes';\\r\\n    var Verbose = $tw.wiki.getTiddlerText(DEBUG_VERBOSE) === 'yes';\\r\\n    var savedConfig = $TPouch.config.readConfigTiddler();\\r\\n    savedConfig.debug = {active: Active, verbose: Verbose};\\r\\n    $TPouch.config.update(savedConfig);\\r\\n}\\r\\n\\r\\n/**\\r\\n *  Updates the debug ui to reflect the configuration \\r\\n * \\r\\n * @param {Object} config\\r\\n */\\r\\nfunction updateDebugUI(config){\\r\\n    $tw.wiki.addTiddler(new $tw.Tiddler({title: DEBUG_ACTIVE, text: Utils.boolToHuman(config.debug.active)}));\\r\\n    $tw.wiki.addTiddler(new $tw.Tiddler({title: DEBUG_VERBOSE, text: Utils.boolToHuman(config.debug.verbose)}));\\r\\n}\\r\\n\\r\\n/**\\r\\n * Updates the databases section of the stored configuration \\r\\n * with new values for one database from the user interface.\\r\\n * Note that the configuration being updated may not be the configuratin of the currentDB,\\r\\n * the user can select a DB different from the curent one and save that config.\\r\\n */\\r\\nexports.handlers.updateDbConfig = function(event){\\r\\n    var savedConfig = $TPouch.config.readConfigTiddler();\\r\\n    var uiConfig = $tw.wiki.getTiddlerData(SELECTED_DATABASE);\\r\\n\\r\\n    savedConfig.selectedDbId = uiConfig.name;\\r\\n    savedConfig.databases[uiConfig.name] = Utils.plainToNestedObject(uiConfig);\\r\\n    $TPouch.config.update(savedConfig);\\r\\n}\\r\\n\\r\\n/**\\r\\n * Event handler that should be triggered when a database name is selected.\\r\\n * It loads it's configuration and refreshes the UI with it.\\r\\n */\\r\\nexports.handlers.databaseHasBeenSelected = function(event) {\\r\\n    var dbName = event.param;\\r\\n    var dbConfig = $TPouch.config.getDatabaseConfig(dbName);\\r\\n    refreshSelectedDBUI(dbConfig);\\r\\n}\\r\\n\\r\\n/**\\r\\n * Refreshes the UI with the provided database configuration\\r\\n * \\r\\n * @param {Object} dbConfig\\r\\n */\\r\\nfunction refreshSelectedDBUI(dbConfig) {\\r\\n    //var dbInfo = config.databases[config.selectedDbId];\\r\\n    var uiConfig = Utils.flattenObject(dbConfig);\\r\\n    $tw.wiki.addTiddler(new $tw.Tiddler({\\r\\n        title: SELECTED_DATABASE,\\r\\n        type: \\\"application/json\\\",\\r\\n        text: JSON.stringify(uiConfig)\\r\\n    }));\\r\\n}\\r\\n\\r\\n})();\",\n            \"type\": \"application/javascript\",\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/ui/config.js\",\n            \"module-type\": \"library\"\n        },\n        \"$:/plugins/danielo515/tiddlypouch/utils\": {\n            \"text\": \"/*\\\\\\r\\ntitle: $:/plugins/danielo515/tiddlypouch/utils\\r\\ntype: application/javascript\\r\\nmodule-type: library\\r\\n\\r\\nCollection of functions to help with some repetitive tasks.\\r\\nIt is different from the utils created at startup, which are tiddlypoucyh focused\\r\\nThis one should be required in order to be used.\\r\\n\\r\\n\\r\\n\\r\\n@preserve\\r\\n\\r\\n\\\\*/\\r\\n\\r\\n/*jslint node: false, browser: true */\\r\\n/*global $tw: false */\\r\\n\\\"use strict\\\";\\r\\n\\r\\n\\r\\n/**\\r\\n * @namespace utils\\r\\n */\\r\\n\\r\\nvar utils =\\r\\n    {\\r\\n        boolToHuman: boolToHuman,\\r\\n        plainToNestedObject: plainToNestedObject,\\r\\n        flattenObject: flattenObject,\\r\\n        saveAsJsonTiddler: saveAsJsonTiddler,\\r\\n    };\\r\\n\\r\\nmodule.exports = utils;\\r\\n\\r\\nfunction saveAsJsonTiddler(title, data, beautify) {\\r\\n    var formatParameters = beautify ? $tw.config.preferences.jsonSpaces : null;\\r\\n    $tw.wiki.addTiddler(new $tw.Tiddler({\\r\\n        title: title,\\r\\n        type: \\\"application/json\\\",\\r\\n        text: JSON.stringify(data, null, formatParameters)\\r\\n    }));\\r\\n}\\r\\n\\r\\n// source: https://gist.github.com/gdibble/9e0f34f0bb8a9cf2be43\\r\\nfunction flattenObject(ob) {\\r\\n    var toReturn = {};\\r\\n    var flatObject;\\r\\n    for (var i in ob) {\\r\\n        if (!ob.hasOwnProperty(i)) {\\r\\n            continue;\\r\\n        }\\r\\n        if ((typeof ob[i]) === 'object') {\\r\\n            flatObject = flattenObject(ob[i]);\\r\\n            for (var x in flatObject) {\\r\\n                if (!flatObject.hasOwnProperty(x)) {\\r\\n                    continue;\\r\\n                }\\r\\n                toReturn[i + (!!isNaN(x) ? '.' + x : '')] = flatObject[x];\\r\\n            }\\r\\n        } else {\\r\\n            toReturn[i] = ob[i];\\r\\n        }\\r\\n    }\\r\\n    return toReturn;\\r\\n}\\r\\n\\r\\nfunction plainToNestedObject(plain) {\\r\\n    var result = {};\\r\\n    $tw.utils.each(plain,\\r\\n        function (value, key) {\\r\\n            createChilds(result, key.split('.'), value)\\r\\n        });\\r\\n    return result;\\r\\n    function createChilds(ob, keys, value) {\\r\\n        keys = keys.slice(); // No side effects please\\r\\n        var lastKey = keys.pop(); // Pop is handy but mutates the array\\r\\n        var lastChild = keys.reduce(\\r\\n            function (ob, k) {\\r\\n                ob[k] = ob[k] || {};\\r\\n                return ob[k];\\r\\n            }\\r\\n            , ob);\\r\\n        lastChild[lastKey] = value;\\r\\n        return ob;\\r\\n    }\\r\\n}\\r\\n\\r\\n/**\\r\\n * Translates true/false to yes/no\\r\\n *\\r\\n * @param {Boolean} value value to convert\\r\\n * @returns {String} yes/no string\\r\\n */\\r\\nfunction boolToHuman(value) {\\r\\n    return value ? \\\"yes\\\" : \\\"no\\\"\\r\\n}\",\n            \"title\": \"$:/plugins/danielo515/tiddlypouch/utils\",\n            \"type\": \"application/javascript\",\n            \"module-type\": \"library\"\n        }\n    }\n}"
  }
]